
    <!DOCTYPE html>
    <html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <!-- PWA CONFIGURATION -->
        <link rel="manifest" href="manifest.json">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="theme-color" content="#0f172a">
            <!-- Ic√¥ne pour l'onglet du navigateur -->
        <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/128/13594/13594876.png">
        <!-- Ic√¥ne pour iPhone/iPad (Apple) -->
        <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/128/13594/13594876.png">

        <title>SIRH Pro | Secure Access</title>
    
        <!-- Biblioth√®ques -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://unpkg.com/html5-qrcode"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

        <link href="style.css" rel="stylesheet">

    </head>



    <body class="text-slate-900 overflow-hidden h-screen w-full"> 


    <!-- LOADER PREMIUM -->
    <div id="initial-loader" class="fixed inset-0 bg-slate-900 z-[999] flex flex-col items-center justify-center transition-all duration-1000 ease-in-out">
    <!-- Logo Container -->
    <div class="relative mb-8">
        <div class="absolute inset-0 bg-blue-500 rounded-full blur-xl opacity-20 animate-pulse"></div>
        <div class="relative bg-slate-800 p-6 rounded-3xl border border-slate-700 shadow-2xl flex items-center justify-center">
            <i class="fa-solid fa-fingerprint text-5xl text-blue-500 animate-pulse"></i>
        </div>
    </div>
    
    <!-- Texte -->
    <h2 class="text-white text-2xl font-black tracking-tight mb-2">SIRH <span class="text-blue-500">SECURE</span></h2>
    <p class="text-slate-400 text-[10px] font-bold uppercase tracking-[0.3em] mb-8">CHARGEMENT...</p>

    <!-- Barre de chargement am√©lior√©e -->
    <div class="w-64 h-1 bg-slate-800 rounded-full overflow-hidden relative">
        <!-- La barre interne avec animation de va-et-vient (ind√©termin√©e) -->
        <div class="h-full bg-gradient-to-r from-blue-600 to-indigo-400 rounded-full absolute top-0" 
             style="width: 40%; animation: bar-slide 1.8s infinite ease-in-out; box-shadow: 0 0 15px rgba(37, 99, 235, 0.4);">
        </div>
    </div>
</div>



        <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-slate-900/80 z-40 hidden md:hidden transition-opacity backdrop-blur-sm"></div>

        <!-- ECRAN DE CONNEXION -->
        <div id="login-screen" class="fixed inset-0 bg-slate-900 flex items-center justify-center z-[100] transition-all duration-500 p-4">
            <div class="bg-white p-6 md:p-10 rounded-3xl shadow-2xl w-full max-w-md border border-slate-100">
                <div class="text-center mb-8">
                    <div class="inline-flex items-center justify-center w-20 h-20 bg-blue-600 rounded-2xl shadow-xl shadow-blue-500/30 mb-6 text-white"><i class="fa-solid fa-fingerprint text-3xl"></i></div>
                    <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight text-center">SIRH Secure</h1>
                    <p class="text-slate-400 mt-2 font-medium text-center">Portail De Connexion</p>
                </div>
                <form onsubmit="handleLogin(event)" class="space-y-5">
                    <div><label class="block text-xs font-bold text-slate-500 uppercase mb-2">Identifiant</label><input type="text" id="login-user" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" required></div>
                    <div><label class="block text-xs font-bold text-slate-500 uppercase mb-2">Mot de passe</label><input type="password" id="login-pass" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" required></div>
                    <button type="submit" id="btn-login" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl hover:bg-blue-700 shadow-lg transition-all active:scale-95 uppercase tracking-widest">Se Connecter</button>
                    <div class="text-center mt-4">
                    <button type="button" onclick="handleForgotPassword()" class="text-xs font-bold text-blue-600 hover:underline">Mot de passe oubli√© ?</button>
</div>
                </form>
            </div>
        </div>

        <!-- APP LAYOUT -->
        <div id="app-layout" class="hidden h-screen flex flex-col md:flex-row overflow-hidden relative">
            <aside id="sidebar" class="w-72 bg-slate-900 text-slate-300 flex flex-col fixed md:relative inset-y-0 left-0 z-50 transform -translate-x-full md:translate-x-0 transition-transform duration-300 border-r border-slate-800">
                <div class="p-8 flex-1 overflow-y-auto">
                    <div class="flex items-center justify-between mb-10 text-white">
    
    <div class="flex items-center gap-3">
        <div class="p-1.5 rounded-xl shadow-lg flex items-center justify-center" style="background-color: var(--accent); min-width: 40px; height: 40px;">
            <img src="" class="app-logo-display w-7 h-7 object-contain">
        </div>
        <span class="font-black text-lg tracking-tighter company-name-display">SIRH SECURE</span>
    </div>

                        <button onclick="toggleSidebar()" class="md:hidden text-slate-400"><i class="fa-solid fa-xmark text-xl"></i></button>
                    </div>
  





                <nav class="space-y-4">
                    <!-- SECTION 1 : PERSONNEL -->
                    <div class="menu-group">
                        <div class="flex justify-between items-center px-4 mb-2 cursor-pointer group" onclick="toggleWidget('m-perso')">
                            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Personnel</p>
                            <i id="m-perso-icon" class="fa-solid fa-chevron-up text-[8px] text-slate-600 group-hover:text-blue-500 transition-colors"></i>
                        </div>
                        <div id="m-perso-content" class="space-y-1">
                            <button onclick="switchView('my-profile')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
                                <i class="fa-solid fa-id-badge w-5"></i> <span class="font-semibold">Mon Profil</span>
                            </button>
                            <button onclick="switchView('help')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
                                <i class="fa-solid fa-circle-info w-5"></i> <span class="font-semibold">Infos & Aide</span>
                            </button>

                            <!-- Bouton Chat -->
                        <button data-perm="can_use_chat" onclick="switchView('chat')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
                            <i class="fa-solid fa-comments w-5"></i> 
                            <span class="font-semibold">Messagerie √âquipe</span>
                        </button>
                        </div>
                    </div>



<!-- ========================================================== -->
<!-- BLOC CORRIG√â AVEC LES PERMISSIONS FINALES -->
<!-- ========================================================== -->

<!-- SECTION 2 : GESTION RH -->
<div class="menu-group">
    <div class="flex justify-between items-center px-4 mb-2 cursor-pointer group" onclick="toggleWidget('m-gestion')">
        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Gestion RH</p>
        <i id="m-gestion-icon" class="fa-solid fa-chevron-up text-[8px] text-slate-600 group-hover:text-blue-500 transition-colors"></i>
    </div>
    <div id="m-gestion-content" class="space-y-1">
        
        <!-- Serrure : Tableau de Bord -->
        <button data-perm="can_see_dashboard" onclick="switchView('dash')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-chart-pie w-5"></i> <span class="font-semibold">Tableau de Bord</span>
        </button>

        <!-- Serrure : Diffuser une Annonce -->
        <button data-perm="can_send_announcements" onclick="openFlashModal()" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-bullhorn w-5 text-orange-500"></i> 
            <span class="font-semibold text-orange-400 group-hover:text-white">Diffuser Une Annonce</span>
        </button>

        <!-- Serrure : Collaborateurs -->
        <button data-perm="can_view_team" onclick="switchView('employees')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-user-group w-5"></i> <span class="font-semibold">Collaborateurs</span>
        </button>

        <!-- Serrure : Nouveau Profil -->
        <button data-perm="can_create_profiles" onclick="switchView('add-new')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-user-plus w-5"></i> <span class="font-semibold">Nouveau Profil</span>
        </button>

        <!-- Serrure : Recrutement -->
        <button data-perm="can_see_recruitment" onclick="switchView('recruitment')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-briefcase w-5"></i> <span class="font-semibold">Recrutement</span>
        </button>
    </div>
</div>





                    <!-- SECTION : OP√âRATIONS TERRAIN (Module Mobile) -->
<div class="menu-group" data-module="MOD_MOBILE_WORKFORCE">
    <div class="flex justify-between items-center px-4 mb-2 cursor-pointer group" onclick="toggleWidget('m-ops')">
        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Op√©rations Terrain</p>
        <i id="m-ops-icon" class="fa-solid fa-chevron-up text-[8px] text-slate-600 group-hover:text-blue-500 transition-colors"></i>
    </div>
    <div id="m-ops-content" class="space-y-1">
        
        <!-- Lieux & Sites : can_manage_mobile -->
        <button data-perm="can_manage_mobile_locations" onclick="switchView('mobile-locations')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-map-location-dot w-5"></i> <span class="font-semibold">Lieux & Sites</span>
        </button>

        <!-- Rapports : can_view_reports -->
        <button data-perm="can_manage_schedules" onclick="switchView('mobile-planning')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-calendar-days w-5"></i> <span class="font-semibold">Plannings & Missions</span>
        </button>

        <button data-perm="can_see_catalog" onclick="switchView('catalog')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-box-archive w-5 text-emerald-400"></i> 
            <span class="font-semibold">Catalogue Produits</span>
        </button>

        <!-- Rapports Journaliers -->
        <button data-perm="can_view_reports" onclick="switchView('mobile-reports')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-clipboard-list w-5"></i> 
            <span class="font-semibold">Rapports d'Activit√©</span>
        </button>
    </div>
</div>

                    
<!-- SECTION 3 : FINANCE & SYST√àME -->
<div class="menu-group">
    <div class="flex justify-between items-center px-4 mb-2 cursor-pointer group" onclick="toggleWidget('m-admin')">
        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Finance & Syst√®me</p>
        <i id="m-admin-icon" class="fa-solid fa-chevron-up text-[8px] text-slate-600 group-hover:text-blue-500 transition-colors"></i>
    </div>
    <div id="m-admin-content" class="space-y-1">
        
        <!-- Serrure : Paie -->
        <button data-perm="can_see_payroll" onclick="switchView('accounting')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-calculator w-5 text-emerald-500"></i> 
            <span class="font-semibold text-emerald-400 group-hover:text-white">Paie & Comptabilit√©</span>
        </button>
        
        <!-- Serrure : Param√®tres -->
        <button data-perm="can_manage_config" onclick="switchView('settings')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-gears w-5 text-slate-400"></i> 
            <span class="font-semibold text-slate-400 group-hover:text-white">Param√®tres Si√®ges</span>
        </button>

        <button data-perm="can_manage_config" onclick="switchView('contract-templates')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-file-signature w-5 text-purple-400"></i> 
            <span class="font-semibold text-purple-300 group-hover:text-white">Mod√®les Contrats</span>
        </button>
        
        <!-- Serrure : Audit -->
        <button data-perm="can_see_audit" onclick="switchView('logs')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-list-check w-5"></i> <span class="font-semibold">Audit S√©curit√©</span>
        </button>

        <button data-perm="can_manage_config" onclick="switchView('maintenance')" class="nav-btn w-full flex items-center gap-4 p-4 rounded-xl transition-all hover:text-white group">
            <i class="fa-solid fa-server w-5 text-red-400"></i> 
            <span class="font-semibold text-red-300 group-hover:text-white">Maintenance Syst√®me</span>
        </button>
    </div>
</div>
                    
                </nav>



                </div>
                <div class="mt-auto p-6 border-t border-slate-800 bg-slate-900/50">
                    <div class="flex items-center gap-4 p-3 bg-slate-800/50 rounded-2xl mb-4 border border-slate-700/30">
                        <div id="avatar-display" class="w-10 h-10 bg-gradient-to-tr from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center text-white font-bold uppercase shadow-lg">?</div>
                        <div class="overflow-hidden"><p id="name-display" class="text-sm font-bold text-white truncate">User</p><p id="role-display" class="text-[10px] uppercase font-black text-blue-400">R√¥le</p></div>
                    </div>
                    <button id="install-button" class="hidden w-full flex items-center justify-center gap-2 p-3 mb-2 text-xs font-bold text-emerald-400 bg-emerald-500/10 hover:bg-emerald-500/20 rounded-xl transition-all uppercase tracking-tighter border border-emerald-500/30">
                        <i class="fa-solid fa-download"></i> Installer l'App
                    </button>
                    <button onclick="handleLogout()" class="w-full flex items-center justify-center gap-2 p-3 text-xs font-bold text-red-400 hover:bg-red-500/10 rounded-xl transition-all uppercase tracking-tighter"><i class="fa-solid fa-power-off"></i> D√©connexion</button>           
                </div>
            </aside>

            <main class="flex-1 flex flex-col min-w-0 bg-slate-50 overflow-hidden w-full">

                <header class="h-20 glass border-b border-slate-200 px-4 md:px-8 flex justify-between items-center shrink-0 z-10">


                <div class="flex items-center flex-1 max-w-2xl gap-3">
                        <button onclick="toggleSidebar()" class="md:hidden p-2 text-slate-600 bg-white border border-slate-200 rounded-lg"><i class="fa-solid fa-bars text-lg"></i></button>
                        <div id="global-search-container" class="relative w-full">
                            <i class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                            <input type="text" id="search-input" onkeyup="filterTable()" placeholder="Rechercher..." class="w-full pl-12 pr-4 py-3 bg-slate-100 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none text-sm transition-all">
                        </div>
                    </div>
                    <button onclick="toggleDarkMode()" class="p-2.5 bg-slate-100 dark-toggle-btn text-slate-600 rounded-xl hover:bg-slate-200 transition-all active:scale-95 mr-2">
                    <i class="fa-solid fa-moon text-lg" id="dark-icon"></i>
                    </button>
                    <button onclick="startScanner()" class="bg-slate-900 text-white px-5 py-2.5 rounded-xl text-sm font-bold ml-4 transition-all hover:scale-105 shadow-lg active:scale-95"><i class="fa-solid fa-qrcode mr-2"></i> SCANNER</button>
                </header>

    <div id="main-scroll-container" class="flex-1 overflow-y-auto p-3 md:p-8 scroll-smooth no-scrollbar">             
                    

                    <!-- CONTENEUR POUR PLUSIEURS ALERTES -->
                        <div id="flash-container" class="space-y-3 mb-6"></div>


<!-- VUE 1: DASHBOARD -->
<section id="view-dash" class="view-section active">             
    <!-- EN-T√äTE RESPONSIVE (CORRIG√â) - GARD√â TEL QUEL -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
        <h2 class="text-2xl font-extrabold text-slate-800">Analyse de l'Effectif</h2>
        
<div class="flex flex-wrap gap-2 w-full md:w-auto">
    <button onclick="refreshAllData(true)" class="flex-1 md:flex-none justify-center p-2.5 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition-all text-slate-600 shadow-sm flex items-center gap-2 text-sm font-bold active:scale-95">
        <i class="fa-solid fa-rotate" id="refresh-icon"></i> <span class="hidden sm:inline">Actualiser</span><span class="sm:hidden">Sync</span>
    </button>
    
    <!-- Permission requise pour exporter l'effectif -->
    <button data-perm="can_see_employees" onclick="exportToCSV()" class="flex-1 md:flex-none justify-center p-2.5 bg-emerald-600 text-white rounded-xl hover:bg-emerald-700 transition-all shadow-sm flex items-center gap-2 text-sm font-bold active:scale-95">
        <i class="fa-solid fa-file-excel"></i> Exporter
    </button>

    <!-- Permission requise pour voir les rapports de pr√©sence globaux -->
    <button data-perm="can_see_dashboard" onclick="openAttendancePicker()" class="flex-1 md:flex-none justify-center p-2.5 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-all shadow-sm flex items-center gap-2 text-sm font-bold active:scale-95">
        <i class="fa-solid fa-clipboard-list"></i> Rapport Pr√©sence
    </button>

    <div id="current-date" class="w-full sm:w-auto text-center bg-blue-50 text-blue-700 px-4 py-2.5 rounded-xl font-bold text-sm border border-blue-100 italic">--</div>
</div>
        
    </div>

    <!-- 1. BLOC : STATS CARDS -->
    <div class="mb-8">
        <div class="flex justify-between items-center mb-3 cursor-pointer group" onclick="toggleWidget('w-stats')">
            <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Aper√ßu de l'Effectif</h3>
            <i id="w-stats-icon" class="fa-solid fa-chevron-up text-slate-300 group-hover:text-blue-600 transition-all"></i>
        </div>
        <div id="w-stats-content" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="bg-white p-7 rounded-3xl shadow-sm border border-slate-100"><p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Effectif Total</p><h3 id="stat-total" class="text-4xl font-black mt-2 text-slate-800">0</h3></div>
            <div class="bg-white p-7 rounded-3xl shadow-sm border border-slate-100"><p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Alertes Contrats</p><h3 id="stat-alert" class="text-4xl font-black mt-2 text-red-600">0</h3></div>
            <div class="bg-white p-7 rounded-3xl shadow-sm border border-slate-100"><p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Collaborateurs Actifs</p><h3 id="stat-active" class="text-4xl font-black mt-2 text-emerald-600">0</h3></div>
        </div>
    </div>

    <!-- 2. BLOC : LIVE TRACKER WIDGET -->
    <div class="mb-8">
        <div class="flex justify-between items-center mb-3 cursor-pointer group" onclick="toggleWidget('w-live')">
            <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Pointage en Direct</h3>
            <i id="w-live-icon" class="fa-solid fa-chevron-up text-slate-300 group-hover:text-blue-600 transition-all"></i>
        </div>
        <div id="w-live-content" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="bg-emerald-500 rounded-3xl p-6 text-white shadow-lg shadow-emerald-200 relative overflow-hidden">
                <div class="relative z-10">
                    <p class="text-[10px] font-black uppercase opacity-80">En poste actuellement</p>
                    <h3 id="live-presents-count" class="text-4xl font-black mt-1">0</h3>
                    <div id="live-presents-list" class="flex -space-x-2 mt-4 overflow-hidden"></div>
                </div>
                <i class="fa-solid fa-house-user absolute -right-4 -bottom-4 text-6xl opacity-20"></i>
            </div>
            <div class="bg-blue-500 rounded-3xl p-6 text-white shadow-lg shadow-blue-200 relative overflow-hidden">
                <div class="relative z-10">
                    <p class="text-[10px] font-black uppercase opacity-80">Journ√©e termin√©e</p>
                    <h3 id="live-partis-count" class="text-4xl font-black mt-1">0</h3>
                    <div id="live-partis-list" class="flex -space-x-2 mt-4 overflow-hidden"></div>
                </div>
                <i class="fa-solid fa-car-side absolute -right-4 -bottom-4 text-6xl opacity-20"></i>
            </div>
            <div class="bg-slate-800 rounded-3xl p-6 text-white shadow-lg relative overflow-hidden">
                <div class="relative z-10">
                    <p class="text-[10px] font-black uppercase opacity-80">Absents / Non point√©s</p>
                    <h3 id="live-absents-count" class="text-4xl font-black mt-1">0</h3>
                    <div id="live-absents-list" class="flex -space-x-2 mt-4 overflow-hidden"></div>
                </div>
                <i class="fa-solid fa-user-slash absolute -right-4 -bottom-4 text-6xl opacity-20"></i>
            </div>
        </div>
    </div>

    <!-- 3. BLOC : ZONE GRAPHIQUES -->
    <div class="mb-8">
        <div class="flex justify-between items-center mb-3 cursor-pointer group" onclick="toggleWidget('w-charts')">
            <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Analyses Graphiques</h3>
            <i id="w-charts-icon" class="fa-solid fa-chevron-up text-slate-300 group-hover:text-blue-600 transition-all"></i>
        </div>
        <div id="w-charts-content" class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
            <div class="bg-white p-6 rounded-3xl shadow-xl border border-slate-100">
                <p class="font-bold text-slate-700 mb-4 uppercase text-xs tracking-widest">R√©partition par Statut</p>
                <canvas id="chartStatus" height="200"></canvas>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-xl border border-slate-100">
                <p class="font-bold text-slate-700 mb-4 uppercase text-xs tracking-widest">R√©partition par D√©partement</p>
                <canvas id="chartDept" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- 4. BLOC : SECTION VALIDATION CONG√âS -->
    <div class="mb-8 management-only">
        <div class="flex justify-between items-center mb-3 cursor-pointer group" onclick="toggleWidget('w-leaves')">
            <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Gestion des Absences</h3>
            <i id="w-leaves-icon" class="fa-solid fa-chevron-up text-slate-300 group-hover:text-blue-600 transition-all"></i>
        </div>
    <div id="w-leaves-content" data-perm="can_see_employees">
            <div id="manager-leave-section" class="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden mb-10">
                <div class="px-8 py-6 border-b border-slate-100 font-extrabold text-slate-700 flex items-center gap-2">
                    <i class="fa-solid fa-clipboard-check text-blue-500"></i> Demandes de cong√©s √† valider
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left whitespace-nowrap">
                            <!-- On ajoute data-perm sur le header de la colonne Action -->
                            <thead class="bg-slate-50/80 text-[10px] uppercase font-black text-slate-400">
                                <tr>
                                    <th class="px-8 py-4">Nom</th>
                                    <th class="px-8 py-4">Poste</th>
                                    <th class="px-8 py-4">D√©lai</th>
                                    <th data-perm="can_see_employees" class="px-8 py-4 text-right">Action</th>
                                </tr>
                            </thead>
                        <tbody id="leave-requests-body" class="divide-y divide-slate-50"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 5. BLOC : ALERT TABLE -->
    <div class="mb-8">
        <div class="flex justify-between items-center mb-3 cursor-pointer group" onclick="toggleWidget('w-alerts')">
            <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Suivi des Contrats</h3>
            <i id="w-alerts-icon" class="fa-solid fa-chevron-up text-slate-300 group-hover:text-blue-600 transition-all"></i>
        </div>
        <div id="w-alerts-content">
            <div class="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden">
                <div class="px-8 py-6 border-b border-slate-100 font-extrabold text-slate-700 flex items-center gap-2">
                    <i class="fa-solid fa-hourglass-half text-orange-500"></i> Alertes Fin de Contrat / Essai
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left whitespace-nowrap">
                        <thead class="bg-slate-50/80 text-[10px] uppercase font-black text-slate-400">
                            <tr><th class="px-8 py-4">Nom</th><th class="px-8 py-4">Poste</th><th class="px-8 py-4">D√©lai</th><th class="px-8 py-4 rh-only text-right">Action</th></tr>
                        </thead>
                        <tbody id="dashboard-body" class="divide-y divide-slate-50"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>


                

    <!-- VUE 2: LISTE COLLABORATEURS -->
    <section id="view-employees" class="view-section">
        <!-- EN-T√äTE (HAUT) AVEC FILTRES -->
        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-end mb-6 px-1 gap-4">
            <div>
                <h2 class="text-2xl font-extrabold text-slate-800 tracking-tight">Liste des Collaborateurs</h2>
                <p class="text-sm text-slate-500 font-medium mt-1">Gestion administrative et contractuelle</p>
                
                <!-- ZONE DE FILTRES INTELLIGENTS -->
                <!-- NOUVELLE BARRE DE FILTRES MINIMALISTE -->
<div class="flex flex-col gap-6 mb-8 animate-fadeIn">
    
    <!-- Ligne 1 : Statuts et Activit√©s (Les plus utilis√©s) -->
    <div class="flex flex-wrap items-center gap-3">
        
        <!-- Filtre Statut -->
        <div id="filter-group-status" class="flex p-1 bg-slate-100 rounded-2xl border border-slate-200 shadow-inner">
            <button onclick="setEmployeeFilter('status', 'all')" data-value="all" class="filter-chip px-4 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-widest bg-blue-600 text-white shadow-sm transition-all">Tous</button>
            <button onclick="setEmployeeFilter('status', 'Actif')" data-value="Actif" class="filter-chip px-4 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-blue-600 transition-all">Actifs</button>
            <button onclick="setEmployeeFilter('status', 'Cong√©')" data-value="Cong√©" class="filter-chip px-4 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-blue-600 transition-all">Cong√©s</button>
            <button onclick="setEmployeeFilter('status', 'Sortie')" data-value="Sortie" class="filter-chip px-4 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-widest text-slate-500 hover:text-blue-600 transition-all">Sortis</button>
        </div>

        <div class="h-6 w-[1px] bg-slate-300 mx-2 hidden md:block"></div>

        <!-- Filtre Activit√© -->
        <div id="filter-group-type" class="flex gap-2">
            <button onclick="setEmployeeFilter('type', 'OFFICE')" data-value="OFFICE" class="filter-chip px-4 py-2 rounded-2xl border border-slate-200 bg-white text-[10px] font-black uppercase text-slate-500 hover:border-blue-400 hover:text-blue-600 transition-all flex items-center gap-2">
                <i class="fa-solid fa-building text-[12px]"></i> Bureau
            </button>
            <button onclick="setEmployeeFilter('type', 'MOBILE')" data-value="MOBILE" class="filter-chip px-4 py-2 rounded-2xl border border-slate-200 bg-white text-[10px] font-black uppercase text-slate-500 hover:border-blue-400 hover:text-blue-600 transition-all flex items-center gap-2">
                <i class="fa-solid fa-car-side text-[12px]"></i> Terrain
            </button>
        </div>
    </div>

    <!-- Ligne 2 : D√©partements (Plus discret) -->
    <div class="flex flex-wrap items-center gap-2 overflow-x-auto no-scrollbar pb-2">
        <span class="text-[9px] font-black text-slate-400 uppercase mr-2"><i class="fa-solid fa-filter mr-1"></i> D√©partements :</span>
        <div id="filter-group-dept" class="flex gap-2">
            <button onclick="setEmployeeFilter('dept', 'all')" data-value="all" class="filter-chip px-3 py-1.5 rounded-full border border-blue-600 bg-blue-50 text-blue-700 text-[9px] font-black uppercase transition-all">Tous</button>
            <button onclick="setEmployeeFilter('dept', 'IT & Tech')" data-value="IT & Tech" class="filter-chip px-3 py-1.5 rounded-full border border-slate-200 bg-white text-slate-500 text-[9px] font-black uppercase hover:border-blue-300 transition-all">IT</button>
            <button onclick="setEmployeeFilter('dept', 'Commercial')" data-value="Commercial" class="filter-chip px-3 py-1.5 rounded-full border border-slate-200 bg-white text-slate-500 text-[9px] font-black uppercase hover:border-blue-300 transition-all">Commercial</button>
            <button onclick="setEmployeeFilter('dept', 'Finance')" data-value="Finance" class="filter-chip px-3 py-1.5 rounded-full border border-slate-200 bg-white text-slate-500 text-[9px] font-black uppercase hover:border-blue-300 transition-all">Finance</button>
            <button onclick="setEmployeeFilter('dept', 'RH')" data-value="RH" class="filter-chip px-3 py-1.5 rounded-full border border-slate-200 bg-white text-slate-500 text-[9px] font-black uppercase hover:border-blue-300 transition-all">RH</button>
        </div>
    </div>
</div>
                
                
            </div>
        </div>

        <!-- TABLEAU -->
        <div class="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden min-h-[500px] flex flex-col justify-between">
            <div class="overflow-x-auto">
                <table class="w-full text-left whitespace-nowrap">
                    <thead class="bg-slate-900 text-white text-[10px] uppercase font-bold">
                        <tr>
                            <th class="px-8 py-5">Identit√©</th>
                            <th class="px-8 py-5">Poste</th>
                            <th class="px-8 py-5">Statut</th>
                            <th data-perm="can_see_employees" class="px-8 py-5 text-right">Dossier & Actions</th>                        
                        </tr>
                    </thead>
                    <tbody id="full-body" class="divide-y divide-slate-100"></tbody>
                </table>
            </div>

            <!-- PAGINATION BAS -->
  <!-- Remplace l'ancien bloc de pagination (celui qui a le texte "AFFICHAGE PAR 10") par celui-ci -->
<div id="employee-pagination-footer" class="border-t border-slate-100 bg-slate-50 p-4 flex justify-between items-center">
    <!-- Ce contenu sera rempli dynamiquement par le JavaScript -->
</div>
                
            </div>
    </section>



                    <!-- VUE 3: AJOUT -->
                  
        <section id="view-add-new" class="view-section">
    <div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden border">
        <div class="bg-slate-900 px-10 py-6 text-white flex justify-between items-center">
            <h2 class="text-xl font-bold">Nouveau Profil</h2>
            <i class="fa-solid fa-user-plus opacity-20 text-3xl"></i>
        </div>
        <form id="form-onboarding" onsubmit="handleOnboarding(event)" class="p-10 grid grid-cols-1 md:grid-cols-3 gap-8">
<!-- 1. SECTION IDENTIT√â G√âN√âRALE -->
<div class="md:col-span-2 space-y-4">
    <!-- Ligne Civilit√© + Nom -->
<div class="grid grid-cols-3 gap-4">
    <div>
        <label class="block text-[9px] font-bold text-slate-400 uppercase mb-1">Civilit√©</label>
        <select id="f-civilite" class="w-full p-4 bg-slate-50 border rounded-xl font-medium outline-none">
            <option value="Monsieur">Monsieur</option>
            <option value="Madame">Madame</option>
        </select>
    </div>
    <div class="col-span-2">
        <label class="block text-[9px] font-bold text-slate-400 uppercase mb-1">Nom Complet</label>
        <input type="text" id="f-nom" class="w-full p-4 bg-slate-50 border rounded-xl outline-none" placeholder="Ex: Damien HABIB" required>
    </div>
</div>

    <input type="email" id="f-email" class="w-full p-4 bg-slate-50 border rounded-xl outline-none" placeholder="Email Pro" required>
    
    <div class="grid grid-cols-2 gap-4">
        <input type="tel" id="f-phone" class="w-full p-4 bg-slate-50 border rounded-xl outline-none" placeholder="T√©l√©phone">
        <input type="date" id="f-dob" class="w-full p-4 bg-slate-50 border rounded-xl outline-none" title="Date de naissance">
    </div>
    
    <input type="text" id="f-address" class="w-full p-4 bg-slate-50 border rounded-xl outline-none" placeholder="Adresse de r√©sidence">

    <!-- 2. SECTION AFFECTATION (D√©partement / Type / R√¥le) -->
    <div class="grid grid-cols-2 gap-4 pt-2">
        <div>
            <label class="block text-[9px] font-bold text-slate-400 uppercase mb-1">D√©partement</label>
            <select id="f-dept" class="w-full p-4 bg-slate-50 border rounded-xl font-medium">
                <option value="">Chargement...</option>
            </select>
        </div>
        <div>
            <label class="block text-[9px] font-bold text-slate-400 uppercase mb-1">Poste occup√©</label>
            <input type="text" id="f-poste" class="w-full p-4 bg-slate-50 border rounded-xl outline-none" placeholder="Ex: D√©l√©gu√© M√©dical" required>
        </div>
        <div>
            <label class="block text-[9px] font-bold text-slate-400 uppercase mb-1">Type d'Activit√©</label>
            <select id="f-type" class="w-full p-4 bg-indigo-50 border border-indigo-100 rounded-xl font-bold text-indigo-700">
                <option value="OFFICE">üè¢ Bureau (Fixe)</option>
                <option value="FIXED">üè† Agent Site (Fixe)</option>
                <option value="MOBILE">üöó D√©l√©gu√© (Nomade)</option>
            </select>
        </div>
        <div>
            <label class="block text-[9px] font-bold text-slate-400 uppercase mb-1">R√¥le Syst√®me</label>
            <select id="f-role" class="w-full p-4 bg-blue-50 border border-blue-200 rounded-xl font-bold text-blue-700">
                <!-- Rempli par syncAllRoleSelects() dans app.js -->
            </select>
        </div>
    </div>



    
    <!-- 3. SECTION CONTRAT & FINANCES (Le nouveau bloc intelligent) -->
    <div class="md:col-span-2 bg-green-50 p-6 rounded-[2rem] border-2 border-dashed border-green-200 space-y-6">
        <p class="text-[10px] font-black text-green-600 uppercase tracking-widest flex items-center gap-2">
            <i class="fa-solid fa-file-signature text-lg"></i> Conditions Contractuelles & Mod√®le
        </p>

        <!-- S√©lecteur de Mod√®le Google Docs -->
        <div>
            <label class="block text-[9px] font-black text-slate-500 uppercase mb-1">Quel mod√®le Google Doc utiliser pour ce contrat ?</label>
            <select id="f-contract-template-selector" class="w-full p-3 bg-white border border-green-200 rounded-xl text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-green-500">
                <option value="">-- Choisir un mod√®le Docx --</option>
                <!-- Rempli par fetchContractTemplatesForSelection() -->
            </select>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            <div>
                <label class="block text-[9px] font-bold text-slate-500 uppercase mb-1">Date d'embauche</label>
                <input type="date" id="f-date" class="w-full p-3 bg-white border border-green-100 rounded-xl text-sm outline-none" required>
            </div>
            <div>
                <label class="block text-[9px] font-bold text-slate-500 uppercase mb-1">Dur√©e (Type)</label>
                <select id="f-limit" class="w-full p-3 bg-white border border-green-100 rounded-xl text-sm outline-none">
                    <option value="365">CDI (1 an+)</option>
                    <option value="180">CDD (6 mois)</option>
                    <option value="90">Essai (3 mois)</option>
                </select>
            </div>
            <div>
                <label class="block text-[9px] font-bold text-slate-500 uppercase mb-1">P√©riode d'essai</label>
                <input type="text" id="f-duree-essai" class="w-full p-3 bg-white border border-green-100 rounded-xl text-sm outline-none" placeholder="Ex: 3 mois" value="3 mois">
            </div>
            <div>
                <label class="block text-[9px] font-bold text-slate-500 uppercase mb-1">Salaire de Base (CFA)</label>
                <input type="number" id="f-salaire-fixe" class="w-full p-3 bg-white border border-green-100 rounded-xl text-sm font-black text-blue-600 outline-none" value="0">
            </div>
            <div>
                <label class="block text-[9px] font-bold text-slate-500 uppercase mb-1">Temps de travail</label>
                <input type="text" id="f-temps-travail" class="w-full p-3 bg-white border border-green-100 rounded-xl text-sm outline-none" value="40 Heures">
            </div>
            <div>
                <label class="block text-[9px] font-bold text-slate-500 uppercase mb-1">Lieu de signature</label>
                <input type="text" id="f-lieu-signature" class="w-full p-3 bg-white border border-green-100 rounded-xl text-sm outline-none" value="Cotonou">
            </div>
        </div>

        <!-- Champs sp√©cifiques (Visible uniquement si Type d'activit√© = MOBILE) -->
        <div data-employee-type="MOBILE" class="field-group-contract grid grid-cols-2 gap-4 pt-2 border-t border-green-100 hidden">
            <div>
                <label class="block text-[9px] font-bold text-green-700 uppercase mb-1">Indemnit√© Transport (Mobile)</label>
                <input type="number" id="f-indemnite-transport" class="w-full p-3 bg-white border border-green-200 rounded-xl text-sm outline-none" value="0">
            </div>
            <div>
                <label class="block text-[9px] font-bold text-green-700 uppercase mb-1">Indemnit√© Logement (Mobile)</label>
                <input type="number" id="f-indemnite-logement" class="w-full p-3 bg-white border border-green-200 rounded-xl text-sm outline-none" value="0">
            </div>
        </div>

        <!-- Infos naissance -->
        <div class="grid grid-cols-2 gap-4 pt-2 border-t border-green-100">
            <div>
                <label class="block text-[9px] font-bold text-slate-500 uppercase mb-1">Lieu de Naissance</label>
                <input type="text" id="f-lieu-naissance" class="w-full p-3 bg-white border border-green-100 rounded-xl text-sm outline-none" placeholder="Ville, Pays">
            </div>
            <div>
                <label class="block text-[9px] font-bold text-slate-500 uppercase mb-1">Nationalit√©</label>
                <input type="text" id="f-nationalite" class="w-full p-3 bg-white border border-green-100 rounded-xl text-sm outline-none" value="B√©ninoise">
            </div>
        </div>
    </div>

    <!-- 4. HI√âRARCHIE -->
    <div class="col-span-2 bg-slate-50 p-4 rounded-xl border border-slate-200">
        <p class="text-[10px] font-black text-slate-500 uppercase mb-3 tracking-widest">Hi√©rarchie & √âquipe</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-[9px] font-bold text-slate-500 uppercase mb-1">Responsable Direct (N+1)</label>
                <select id="f-manager" class="w-full p-3 bg-white border border-slate-200 rounded-lg text-sm outline-none">
                    <option value="">-- Aucun / Autonome --</option>
                </select>
            </div>
            <div>
                <label class="block text-[9px] font-bold text-slate-500 uppercase mb-1">Zone/D√©p. G√©r√© (Scope)</label>
                <input type="text" id="f-scope" class="w-full p-3 bg-white border border-slate-200 rounded-lg text-sm outline-none" placeholder="Ex: Commercial, Cotonou...">
            </div>
        </div>
    </div>
</div>


            
<!-- 5. PHOTO DE PROFIL (COLONNE DROITE) -->
<div class="flex flex-col items-center justify-start p-4 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200">
    <div class="w-full h-44 bg-slate-200 rounded-xl mb-4 overflow-hidden flex items-center justify-center">
        <video id="video-stream" class="w-full h-full object-cover hidden" autoplay playsinline></video>
        <img id="captured-image" class="w-full h-full object-cover hidden">
        <i class="fa-solid fa-image text-slate-400 text-3xl" id="photo-placeholder"></i>
    </div>
    <div id="initial-controls" class="flex flex-col w-full gap-2 mt-auto">
        <button type="button" onclick="startCameraFeed()" class="w-full text-[10px] font-bold text-slate-500 uppercase bg-white border py-2.5 rounded-lg shadow-sm">Cam√©ra</button>
        <button type="button" onclick="document.getElementById('file-upload').click()" class="w-full text-[10px] font-bold text-blue-600 uppercase bg-blue-50 border border-blue-200 py-2.5 rounded-lg">T√©l√©verser</button>
    </div>
    <canvas id="camera-canvas" class="hidden"></canvas>
    <input type="file" id="file-upload" accept="image/*" class="hidden" onchange="handleFileUpload(event)">
    <button type="button" id="btn-capture" onclick="takeSnapshot()" class="hidden bg-blue-600 text-white py-2.5 rounded-lg w-full mt-2 font-bold text-xs">Prendre</button>
    <button type="button" id="btn-retake" onclick="resetCamera()" class="hidden bg-slate-400 text-white py-2.5 rounded-lg w-full mt-2 font-bold text-xs">Refaire</button>
</div>

<!-- 6. DOCUMENTS KYC -->
<div class="md:col-span-3 grid grid-cols-1 md:grid-cols-4 gap-4 p-6 bg-slate-100 rounded-2xl border-2 border-dashed border-slate-200 mt-4">
    <p class="md:col-span-4 text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Dossier Num√©rique Obligatoire</p>


<div class="space-y-2">
                    <label class="block text-[9px] font-bold text-slate-400 uppercase">Pi√®ce d'Identit√©</label>
                    <div id="btn-id_card" class="h-20 bg-white rounded-lg border flex items-center justify-center overflow-hidden cursor-pointer hover:bg-slate-50 transition-all" onclick="openDocCamera('id_card')">
                        <img id="preview-id_card" class="hidden h-full w-full object-cover">
                        <i id="icon-id_card" class="fa-solid fa-id-card text-slate-300 text-2xl"></i>
                    </div>
                    <input type="file" id="f-id_card" class="hidden" onchange="previewDocFile(event, 'id_card'); updateFileFeedback('f-id_card', 'btn-id_card')">
                </div>

                <div class="space-y-2">
                    <label class="block text-[9px] font-bold text-slate-400 uppercase">Curriculum Vitae</label>
                    <div id="btn-cv" class="h-20 bg-white rounded-lg border flex items-center justify-center overflow-hidden cursor-pointer hover:bg-slate-50 transition-all" onclick="openDocCamera('cv')">
                        <img id="preview-cv" class="hidden h-full w-full object-cover">
                        <i id="icon-cv" class="fa-solid fa-file-pdf text-slate-300 text-2xl"></i>
                    </div>
                    <input type="file" id="f-cv" class="hidden" onchange="previewDocFile(event, 'cv'); updateFileFeedback('f-cv', 'btn-cv')">
                </div>

                <div class="space-y-2">
                    <label class="block text-[9px] font-bold text-slate-400 uppercase">Dernier Dipl√¥me</label>
                    <div id="btn-diploma" class="h-20 bg-white rounded-lg border flex items-center justify-center overflow-hidden cursor-pointer hover:bg-slate-50 transition-all" onclick="openDocCamera('diploma')">
                        <img id="preview-diploma" class="hidden h-full w-full object-cover">
                        <i id="icon-diploma" class="fa-solid fa-graduation-cap text-slate-300 text-2xl"></i>
                    </div>
                    <input type="file" id="f-diploma" class="hidden" onchange="previewDocFile(event, 'diploma'); updateFileFeedback('f-diploma', 'btn-diploma')">
                </div>

                <div class="space-y-2">
                    <label class="block text-[9px] font-bold text-slate-400 uppercase">Attestation / Autres</label>
                    <div id="btn-attestation" class="h-20 bg-white rounded-lg border flex items-center justify-center overflow-hidden cursor-pointer hover:bg-slate-50 transition-all" onclick="openDocCamera('attestation')">
                        <img id="preview-attestation" class="hidden h-full w-full object-cover">
                        <i id="icon-attestation" class="fa-solid fa-file-invoice text-slate-300 text-2xl"></i>
                    </div>
                    <input type="file" id="f-attestation" class="hidden" onchange="previewDocFile(event, 'attestation'); updateFileFeedback('f-attestation', 'btn-attestation')">
                </div>

</div>

<button type="submit" class="md:col-span-3 w-full bg-slate-900 text-white py-4 rounded-xl font-bold uppercase hover:bg-slate-800 tracking-widest transition-all shadow-xl">CR√âER ET G√âN√âRER LE CONTRAT</button>
            
        </form>
    </div>
</section>


<section id="view-catalog" class="view-section">
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-black text-slate-800 uppercase tracking-tighter">Catalogue Produits</h2>
        <!-- Visible uniquement pour Admin/RH -->
        <button data-perm="can_manage_config" onclick="openAddProductModal()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg">
            + Ajouter un Produit
        </button>
    </div>
    <div id="products-grid" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
        <!-- Rempli par JS -->
    </div>
</section>
        
      <!-- VUE 7: RECRUTEMENT / ATS -->
                    <section id="view-recruitment" class="view-section">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                            <div>
                                <h2 class="text-2xl font-extrabold text-slate-800">Candidatures (Airtable)</h2>
                                <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1">Portail de recrutement et gestion</p>
                            </div>
                            
                            <div class="flex items-center gap-2">
                                <!-- Bouton Partager -->
                                <button onclick="copyFormLink()" class="flex items-center gap-2 p-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all shadow-md text-sm font-bold active:scale-95">
                                    <i class="fa-solid fa-share-nodes"></i> <span class="hidden sm:inline">Partager le lien</span>
                                </button>
                                
                                <!-- Bouton Modifier -->
                                <button onclick="openFormEditor()" class="flex items-center gap-2 p-2.5 bg-slate-800 text-white rounded-xl hover:bg-slate-900 transition-all shadow-md text-sm font-bold active:scale-95">
                                    <i class="fa-solid fa-pen-to-square"></i> <span class="hidden sm:inline">Modifier</span>
                                </button>

                                <!-- Votre bouton Actualiser original -->
                                <button onclick="fetchCandidates()" class="p-2.5 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition-all text-slate-600 shadow-sm font-bold text-sm active:scale-95">
                                    <i class="fa-solid fa-rotate"></i>
                                </button>
                            </div>
                        </div>

                        <div class="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left whitespace-nowrap">
                                    <thead class="bg-slate-900 text-white text-[10px] uppercase font-bold">
                                        <tr>
                                            <th class="px-6 py-5">Candidat</th>
                                            <th class="px-6 py-5">Poste vis√©</th>
                                            <th class="px-6 py-5 text-center">Statut Actuel</th>
                                            <th class="px-6 py-5 text-right">Dossier & Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="candidates-body" class="divide-y divide-slate-100">
                                        <!-- Rempli par JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>



<section id="view-accounting" class="view-section">
    <!-- 1. EN-T√äTE : TITRE, EXCEL ET P√âRIODE -->
    <div class="flex flex-col lg:flex-row justify-between items-center lg:items-end mb-8 gap-6">
        <div>
            <h2 class="text-3xl font-black text-slate-800 tracking-tighter">Comptabilit√©</h2>
            <p class="text-sm font-bold text-slate-400 uppercase tracking-widest">Calcul et √©dition des salaires</p>
        </div>
        
        <div class="flex gap-2">
            <button onclick="exportPayrollTemplate()" class="bg-slate-100 text-slate-600 px-4 py-3 rounded-xl font-bold text-[10px] uppercase hover:bg-slate-200 transition-all flex items-center gap-2 border border-slate-200">
                <i class="fa-solid fa-file-export"></i> Mod√®le Excel
            </button>
            <button onclick="triggerPayrollImport()" class="bg-emerald-50 text-emerald-600 px-4 py-3 rounded-xl font-bold text-[10px] uppercase hover:bg-emerald-100 transition-all flex items-center gap-2 border border-emerald-100">
                <i class="fa-solid fa-file-import"></i> Importer Primes
            </button>
            <input type="file" id="payroll-csv-file" class="hidden" accept=".csv" onchange="handlePayrollImport(event)">
        </div>

        <div class="flex gap-4 bg-white p-3 rounded-[2rem] shadow-xl border border-slate-100 items-center">
            <div class="flex flex-col">
                <label class="text-[9px] font-black text-slate-400 uppercase ml-1">P√©riode de paie</label>
                <div class="flex gap-2">
                    <select id="pay-month" class="font-bold text-sm bg-slate-50 p-2 rounded-lg outline-none">
                        <option>Janvier</option><option>F√©vrier</option><option>Mars</option><option>Avril</option><option>Mai</option><option>Juin</option><option>Juillet</option><option>Ao√ªt</option><option>Septembre</option><option>Octobre</option><option>Novembre</option><option>D√©cembre</option>
                    </select>
                    <input type="number" id="pay-year" value="2026" class="w-20 font-bold text-sm bg-slate-50 p-2 rounded-lg outline-none">
                </div>
            </div>
            <button onclick="generateAllPay()" class="bg-blue-600 text-white h-12 px-8 rounded-xl font-black shadow-lg shadow-blue-200 hover:scale-105 active:scale-95 transition-all">
                PUBLIER LES BULLETINS
            </button>
        </div>
    </div>

    <!-- 2. BARRE DE FILTRES INTELLIGENTE -->
<!-- BARRE DE FILTRES COMPTABILIT√â AVANC√âE -->
<div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 mb-6 space-y-4">
    <div class="flex flex-wrap gap-4 items-center">
        
        <!-- 1. Recherche Nom/Matricule -->
        <div class="flex-1 min-w-[250px] relative">
            <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
            <input type="text" id="search-accounting" onkeyup="filterAccountingTableLocally()" placeholder="Chercher un collaborateur..." class="w-full pl-12 pr-4 py-3 bg-slate-50 border-none rounded-2xl text-sm focus:ring-2 focus:ring-blue-500 transition-all">
        </div>

        <!-- 2. Filtre Activit√© (Fixe/Mobile) -->
        <div class="flex flex-col">
            <label class="text-[8px] font-black text-slate-400 uppercase ml-2 mb-1">Activit√©</label>
            <select id="filter-accounting-type" onchange="loadAccountingView()" class="p-3 bg-slate-50 border-none rounded-2xl text-xs font-bold outline-none cursor-pointer">
                <option value="all">Tous</option>
                <option value="OFFICE">üè¢ Bureau</option>
                <option value="MOBILE">üöó Terrain</option>
                <option value="FIXED">üè† Site Fixe</option>
            </select>
        </div>

        <!-- 3. Filtre D√©partement -->
        <div class="flex flex-col">
            <label class="text-[8px] font-black text-slate-400 uppercase ml-2 mb-1">D√©partement</label>
            <select id="filter-accounting-dept" onchange="loadAccountingView()" class="p-3 bg-slate-50 border-none rounded-2xl text-xs font-bold outline-none cursor-pointer">
                <option value="all">Tous</option>
            </select>
        </div>

        <!-- 4. Filtre Statut (Important pour les fins de contrat) -->
        <div class="flex flex-col">
            <label class="text-[8px] font-black text-slate-400 uppercase ml-2 mb-1">Statut RH</label>
            <select id="filter-accounting-status" onchange="loadAccountingView()" class="p-3 bg-slate-50 border-none rounded-2xl text-xs font-bold outline-none cursor-pointer">
                <option value="Actif">üü¢ Actifs</option>
                <option value="Cong√©">üü° En Cong√©</option>
                <option value="all">‚ö™ Tous (Incl. Sortis)</option>
            </select>
        </div>

        <!-- 5. Bouton Reset -->
        <button onclick="resetAccountingFilters()" class="mt-4 p-3 text-slate-400 hover:text-red-500 transition-all" title="R√©initialiser les filtres">
            <i class="fa-solid fa-filter-circle-xmark text-lg"></i>
        </button>
    </div>
</div>

    <!-- 3. TABLEAU DES SALAIRES -->
    <div class="bg-white rounded-[2rem] shadow-2xl border border-slate-200 overflow-hidden">
        <div class="max-h-[60vh] overflow-y-auto custom-scroll">
            <table class="w-full text-left border-collapse">
                <thead class="sticky top-0 z-10">
                    <tr class="bg-slate-900 text-white text-[10px] uppercase font-black">
                        <th class="px-6 py-6">Collaborateur</th>
                        <th class="px-4 py-6 text-center">Base (CFA)</th>
                        <th class="px-4 py-6 text-center">Primes (+)</th>
                        <th class="px-4 py-6 text-center">Retenues (-)</th>
                        <th class="px-6 py-6 text-right">NET √Ä PAYER</th>
                    </tr>
                </thead>
                <tbody id="accounting-table-body" class="divide-y divide-slate-100">
                    <!-- Rempli par JS -->
                </tbody>
            </table>
        </div>
    </div>
</section>

                    <!-- VUE 4: LOGS -->
                    <section id="view-logs" class="view-section">
                        <div class="bg-white rounded-3xl shadow-xl border overflow-hidden">
                            <div class="p-8 border-b font-black text-slate-800 flex justify-between items-center uppercase text-sm">Journal d'Audit Syst√®me <button onclick="fetchLogs()" class="text-blue-600"><i class="fa-solid fa-rotate"></i></button></div>
                            <div class="overflow-x-auto"><table class="w-full text-left whitespace-nowrap"><thead class="bg-slate-900 text-white text-[10px] uppercase"><tr><th class="p-5">Date</th><th class="p-5">Agent</th><th class="p-5">Action</th><th class="p-5">D√©tails</th></tr></thead><tbody id="logs-body"></tbody></table></div>
                        </div>
                    </section>



                <!-- VUE : MAINTENANCE SYST√àME -->
<section id="view-maintenance" class="view-section">
    <div class="flex justify-between items-center mb-8">
        <div>
            <h2 class="text-2xl font-black text-slate-800 tracking-tight">Maintenance & Archivage</h2>
            <p class="text-sm text-slate-500 font-bold uppercase tracking-widest">Gestion de la sant√© de l'application</p>
        </div>
        <div class="px-4 py-2 bg-emerald-50 text-emerald-700 rounded-lg text-xs font-black border border-emerald-100 flex items-center gap-2">
            <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span> SYST√àME OP√âRATIONNEL
        </div>
    </div>

    <!-- CARTE D'ARCHIVAGE AUTOMATIQUE -->
    <div class="bg-white rounded-[2.5rem] shadow-xl border border-slate-200 overflow-hidden relative">
        <!-- Bandeau d√©coratif -->
        <div class="h-2 bg-gradient-to-r from-slate-700 to-slate-900"></div>
        
        <div class="p-8 md:p-12">
            <div class="flex flex-col md:flex-row gap-8 items-start">
                
                <!-- Ic√¥ne et Description -->
                <div class="flex-1">
                    <div class="w-16 h-16 bg-red-50 text-red-600 rounded-2xl flex items-center justify-center text-3xl mb-6 shadow-sm">
                        <i class="fa-solid fa-database"></i>
                    </div>
                    <h3 class="text-xl font-black text-slate-800 mb-2">Nettoyage et Archivage des Donn√©es</h3>
                    <p class="text-slate-500 text-sm leading-relaxed mb-6">
                        Cette proc√©dure permet de maintenir la rapidit√© de l'application sur le long terme. 
                        Elle d√©place les donn√©es "froides" vers le stockage d'archive et lib√®re de l'espace disque.
                    </p>
                    
                    <!-- Liste des actions -->
                    <div class="bg-slate-50 rounded-2xl p-5 border border-slate-100 space-y-3">
                        <div class="flex items-center gap-3">
                            <i class="fa-solid fa-check text-emerald-500"></i>
                            <span class="text-xs font-bold text-slate-600">Archive les Logs de s√©curit√© de plus d'un an.</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <i class="fa-solid fa-check text-emerald-500"></i>
                            <span class="text-xs font-bold text-slate-600">Supprime les photos de visite > 12 mois (Gain stockage).</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <i class="fa-solid fa-check text-emerald-500"></i>
                            <span class="text-xs font-bold text-slate-600">Archive les dossiers employ√©s "Sortis" depuis > 6 mois.</span>
                        </div>
                    </div>
                </div>

                <!-- Zone d'Action -->
                <div class="w-full md:w-1/3 bg-slate-50 rounded-3xl p-6 border border-slate-200 text-center">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">Action Administrateur</p>
                    <button onclick="runArchivingJob()" class="w-full bg-slate-900 text-white py-4 rounded-xl font-black text-xs uppercase tracking-widest shadow-xl hover:bg-red-600 transition-all active:scale-95 flex items-center justify-center gap-3">
                        <i class="fa-solid fa-recycle"></i> Lancer le Nettoyage
                    </button>
                    <p class="text-[9px] text-slate-400 mt-4 italic">Action recommand√©e 1 fois par trimestre.</p>
                </div>
            </div>
        </div>
    </div>
</section>

                    <!-- VUE : MESSAGERIE D'√âQUIPE -->
<section id="view-chat" class="view-section h-full flex flex-col">
    <!-- En-t√™te -->
    <div class="flex justify-between items-center mb-4 shrink-0 px-1">
        <div>
            <h2 class="text-2xl font-black text-slate-800 tracking-tight">Discussion G√©n√©rale</h2>
            <p class="text-xs text-slate-400 font-bold uppercase tracking-widest">Espace d'√©change collaboratif</p>
        </div>
        <button onclick="fetchMessages()" class="p-3 bg-white border border-slate-200 rounded-xl hover:text-blue-600 transition-all shadow-sm active:scale-95">
            <i class="fa-solid fa-rotate"></i>
        </button>
    </div>

    <!-- Zone des messages (Scrollable) -->
    <div id="chat-container" class="flex-1 bg-white rounded-[2rem] shadow-inner border border-slate-200 p-6 overflow-y-auto custom-scroll space-y-6 mb-4 relative" style="height: 60vh; background-image: radial-gradient(#f1f5f9 1px, transparent 1px); background-size: 20px 20px;">
        <!-- Les messages s'afficheront ici -->
        <div class="flex flex-col items-center justify-center h-full text-slate-300 gap-3">
            <i class="fa-regular fa-comments text-4xl"></i>
            <p class="text-xs font-bold uppercase">Chargement des discussions...</p>
        </div>
    </div>


        <!-- ZONE D'APER√áU AVANT ENVOI -->
        <div id="chat-preview-container" class="hidden px-6 py-3 bg-blue-50 border-t border-blue-100 flex items-center gap-4 animate-fadeIn">
            <div class="relative w-16 h-16 rounded-xl overflow-hidden border-2 border-white shadow-md">
                <img id="chat-img-preview" class="w-full h-full object-cover">
                <button type="button" onclick="cancelFile()" class="absolute top-0 right-0 bg-red-500 text-white p-1 hover:bg-red-600">
                    <i class="fa-solid fa-xmark text-[10px]"></i>
                </button>
            </div>
            <div class="flex-1 overflow-hidden">
                <p id="chat-file-name" class="text-xs font-bold text-blue-700 truncate"></p>
                <p class="text-[9px] text-blue-400 uppercase font-black">Fichier pr√™t √† l'envoi</p>
            </div>
        </div>
    

    <!-- Barre de saisie (Fixe en bas) -->
    <form onsubmit="sendMessage(event)" class="bg-white p-3 rounded-[2rem] border border-slate-200 shadow-xl flex items-end gap-2 shrink-0">
        
        <!-- Bouton Pi√®ce Jointe -->
        <label for="chat-file" class="p-4 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-full cursor-pointer transition-all relative">
            <i class="fa-solid fa-paperclip text-lg"></i>
            <input type="file" id="chat-file" class="hidden" onchange="document.getElementById('file-indicator').classList.remove('hidden')">
            <div id="file-indicator" class="hidden absolute top-3 left-3 w-2 h-2 bg-blue-600 rounded-full border border-white"></div>
        </label>
        
        <!-- Champ Texte -->
        <textarea id="chat-input" rows="1" class="flex-1 bg-slate-50 border-0 rounded-2xl p-4 focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all resize-none font-medium text-slate-700 custom-scroll" placeholder="√âcrivez votre message..." style="min-height: 54px; max-height: 120px;"></textarea>
        
        <!-- Bouton Envoyer -->
        <button type="submit" id="btn-send-chat" class="bg-blue-600 text-white w-14 h-14 rounded-2xl hover:bg-blue-700 transition-all shadow-lg shadow-blue-200 flex items-center justify-center active:scale-95">
            <i class="fa-solid fa-paper-plane text-lg"></i>
        </button>
    </form>
</section>

                    <!-- VUE 5: MON PROFIL (STRUCTURE CORRIG√âE PLEINE LARGEUR) -->
    <section id="view-my-profile" class="view-section">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-2xl font-extrabold text-slate-800 mb-8">Mon Espace Personnel</h2>

            <!-- WIDGET POINTAGE & ACTION -->
            <div class="bg-slate-900 rounded-3xl p-6 mb-8 text-white shadow-xl flex flex-col md:flex-row items-center justify-between relative overflow-hidden">
                <div class="absolute top-0 right-0 w-64 h-64 bg-blue-600 rounded-full blur-[80px] opacity-20 pointer-events-none"></div>
                
                <div class="z-10 mb-6 md:mb-0 text-center md:text-left">
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-1">√âtat Actuel</p>
                    <div class="flex items-center gap-3 justify-center md:justify-start">
                        <div id="clock-status-dot" class="w-3 h-3 rounded-full bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.5)]"></div>
                        <h3 id="clock-status-text" class="text-2xl font-black">NON POINT√â</h3>
                    </div>
                    <p id="clock-last-action" class="text-xs text-slate-500 mt-1 font-mono">Derni√®re action : Aucune</p>
                </div>

                <div class="flex gap-4 z-10 w-full md:w-auto">
                    <button data-perm="can_clock" onclick="handleClockInOut()" id="btn-clock" class="flex-1 md:flex-none bg-emerald-500 hover:bg-emerald-400 text-white px-8 py-4 rounded-2xl font-black uppercase transition-all shadow-lg active:scale-95 flex items-center justify-center gap-2">
                        <i class="fa-solid fa-fingerprint"></i> <span>ENTR√âE</span>
                    </button>
                    <button data-perm="can_request_leave" onclick="openLeaveModal()" class="flex-1 md:flex-none bg-slate-800 hover:bg-slate-700 text-white px-6 py-4 rounded-2xl font-bold uppercase transition-all border border-slate-700 active:scale-95 text-xs">
                        <i class="fa-solid fa-plane-departure mr-2"></i> Demander un Cong√©
                    </button>
                    <button data-module="MOD_MOBILE_WORKFORCE" data-perm="can_submit_daily_report" onclick="openDailyReportModal()" class="flex-1 md:flex-none bg-orange-500 hover:bg-orange-400 text-white px-6 py-4 rounded-2xl font-bold uppercase transition-all shadow-lg active:scale-95 text-xs">
                        <i class="fa-solid fa-flag-checkered mr-2"></i> Rapport de Fin de Journ√©e
                    </button>
                </div>
            </div>


                        <!-- NOUVEAU WIDGET SOLDE CONG√âS -->
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 mb-8 flex justify-between items-center">
                <div>
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">Solde Cong√©s Restant</p>
                    <h3 id="leave-balance-display" class="text-4xl font-black mt-2 text-indigo-600">--</h3>
                </div>
                <div class="p-3 bg-indigo-100 text-indigo-600 rounded-xl"><i class="fa-solid fa-calendar-check text-3xl"></i></div>
            </div>
            <!-- FIN NOUVEAU WIDGET SOLDE CONG√âS -->

            <!-- WIDGET POINTAGE & ACTION (Qui est d√©j√† l√†) -->
            <div class="bg-slate-900 rounded-3xl p-6 mb-8 text-white shadow-xl flex flex-col md:flex-row items-center justify-between relative overflow-hidden">
                <!-- ... le reste du code du pointage ... -->
            </div>

            <!-- ZONE HAUTE : PHOTO (Gauche) + FORMULAIRE (Droite) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                
                <!-- COLONNE GAUCHE : PHOTO & IDENTIT√â -->
                <div class="space-y-6">
                    <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 text-center relative overflow-hidden h-full">
                        <div class="absolute top-0 left-0 w-full h-24 bg-blue-600/10"></div>
                        <div class="relative">
                            <div class="w-28 h-28 bg-white p-1 rounded-full mx-auto mb-4 shadow-lg overflow-hidden relative group">
                                <span id="emp-avatar" class="w-full h-full flex items-center justify-center text-3xl font-bold text-slate-300 bg-slate-50">?</span>
                                <img id="emp-photo-real" class="w-full h-full object-cover hidden">
                                <div onclick="triggerPhotoUpload()" class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 cursor-pointer transition-opacity"><i class="fa-solid fa-camera text-white"></i></div>
                            </div>
                            <h3 id="emp-name" class="font-bold text-xl text-slate-800">...</h3>
                            <p id="emp-job" class="text-sm text-blue-600 font-bold mb-4 uppercase">...</p>
                            <div class="bg-slate-50 rounded-2xl p-4 text-xs space-y-2 text-left border border-slate-100">
                                <div class="flex justify-between font-bold uppercase tracking-tighter"><span>D√©but :</span> <span id="emp-start-date" class="text-slate-800">--/--/----</span></div>
                                <div class="flex justify-between font-bold uppercase tracking-tighter"><span>Fin :</span> <span id="emp-end-date" class="text-slate-800">--/--/----</span></div>
                            </div>
                            <button onclick="downloadMyBadge()" class="w-full bg-slate-900 text-white py-3.5 rounded-xl text-sm font-black mt-6 shadow-xl active:scale-95 transition-all"><i class="fa-solid fa-id-card mr-2"></i> MON BADGE D'ACC√àS</button>
                        </div>
                    </div>
                </div>

                <!-- COLONNE DROITE : FORMULAIRE -->
                <div class="md:col-span-2 space-y-6">
                    <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 h-full">
                        <div class="flex justify-between items-center mb-8"><h3 class="font-bold text-lg text-slate-800">Coordonn√©es</h3><button data-perm="can_edit_own_profile" onclick="toggleEditMode()" class="text-blue-600 text-sm font-bold bg-blue-50 px-4 py-1.5 rounded-lg active:scale-95 transition-all">Modifier</button></div>
                        <form id="form-self-update" class="space-y-5">
                            <input type="file" id="emp-upload-photo" class="hidden" accept="image/*" onchange="previewPhoto(event)">
                            <div class="grid grid-cols-2 gap-6">
                                <div><label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-1">Date de Naissance</label><input type="date" id="emp-dob" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl outline-none" disabled></div>
                                <div><label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-1">T√©l√©phone</label><input type="tel" id="emp-phone" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl outline-none" disabled></div>
                            </div>
                            <div><label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-1">Email Personnel</label><input type="email" id="emp-email" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl outline-none" disabled></div>
                            <div><label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-1">Adresse R√©sidentielle</label><textarea id="emp-address" rows="3" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl resize-none outline-none" disabled></textarea></div>
                            <div id="save-btn-container" class="hidden pt-6 flex justify-end gap-3"><button type="button" onclick="toggleEditMode()" class="px-6 py-3 font-bold text-slate-400 text-sm">Annuler</button><button type="button" onclick="saveMyProfile()" class="bg-blue-600 text-white px-10 py-3 rounded-xl font-black shadow-lg uppercase text-xs">Sauvegarder</button></div>
                        </form>
                    </div>
                </div>
            </div>





            

                <!-- BLOC SUIVI DEMANDES CONG√âS (Employ√©) -->
    <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 mb-8">
        <h3 class="font-black text-xs uppercase text-slate-400 mb-6 flex items-center gap-2 tracking-widest">
            <i class="fa-solid fa-hourglass-half text-blue-500 text-lg"></i> Mes Demandes de Cong√©s
        </h3>
        <div class="overflow-x-auto">
            <table class="w-full text-left whitespace-nowrap">
                <thead class="bg-slate-50/80 text-[10px] uppercase font-black text-slate-400">
                    <tr>
                        <th class="px-6 py-3">P√©riode</th>
                        <th class="px-6 py-3">Type</th>
                        <th class="px-6 py-3">Motif</th>
                        <th class="px-6 py-3 text-right">Statut</th>
                    </tr>
                </thead>
                <tbody id="my-leave-requests-body">
                    <!-- Rempli par le JS -->
                </tbody>
            </table>
        </div>
    </div>
    <!-- FIN BLOC SUIVI DEMANDES CONG√âS -->


<!-- RECAPITULATIF POUR DELEGUES UNIQUEMENT (Ajout de l'ID ici) -->
<div id="mobile-recap-section" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 hidden">
    <!-- RECAP VISITES DU JOUR -->
    <div class="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm">
        <h4 class="text-[10px] font-black text-slate-400 uppercase mb-4 tracking-widest"><i class="fa-solid fa-location-dot mr-2"></i> Mes Visites du Jour</h4>
        <div id="my-today-visits" class="space-y-2 max-h-48 overflow-y-auto custom-scroll"></div>
    </div>

    <!-- RECAP BILANS DU MOIS -->
    <div class="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm">
        <h4 class="text-[10px] font-black text-slate-400 uppercase mb-4 tracking-widest"><i class="fa-solid fa-clipboard-check mr-2"></i> Mes Bilans Mensuels</h4>
        <div id="my-month-dailies" class="space-y-2 max-h-48 overflow-y-auto custom-scroll"></div>
    </div>
</div>

            

            <!-- ZONE BASSE : DOCUMENTS & PAIE (PLEINE LARGEUR MAINTENANT) -->
            <div class="space-y-8">
                
                <!-- BLOC DOCUMENTS -->
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
                    <h3 class="font-black text-xs uppercase text-slate-400 mb-6 flex items-center gap-2 tracking-widest">
                        <i class="fa-solid fa-folder-open text-yellow-500 text-lg"></i> Mes Documents Administratifs
                    </h3>
                    <!-- Le conteneur ID doc-container sera rempli par le JS en mode grille -->
                    <div id="doc-container" class="w-full"></div>
                </div>



            <!-- Bloc Rapports avec Scroll -->
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 mb-8">
                <div class="flex justify-between items-center mb-4"> <!-- mb r√©duit -->
                    <h3 class="font-black text-xs uppercase text-slate-400 flex items-center gap-2 tracking-widest">
                        <i class="fa-solid fa-clock-rotate-left text-indigo-500 text-lg"></i> Mes Rapports d'Activit√©
                    </h3>
                    <button onclick="fetchAttendanceReport('PERSONAL')" class="text-xs font-bold text-indigo-600 bg-indigo-50 px-3 py-1.5 rounded-lg hover:bg-indigo-100 transition-all">
                        <i class="fa-solid fa-rotate mr-1"></i> Actualiser
                    </button>
                </div>
                
                <!-- ICI : On ajoute max-h-[300px] et custom-scroll -->
                <div id="personal-report-container" class="space-y-3 max-h-[300px] custom-scroll pr-2">
                    <p class="text-[10px] text-slate-400 italic">Cliquez sur actualiser pour voir vos rapports.</p>
                </div>
            </div>



                                        <!-- Bloc Paie avec Scroll -->
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-black text-xs uppercase text-slate-400 flex items-center gap-2 tracking-widest">
                            <i class="fa-solid fa-file-invoice-dollar text-emerald-500 text-lg"></i> Mes Bulletins de Paie
                        </h3>
                        <span class="text-[10px] font-bold bg-emerald-50 text-emerald-600 px-2 py-1 rounded">
                            Total : <span id="count-payroll">0</span>
                        </span>
                    </div>

                    <!-- ICI : Scroll vertical + Grille responsive -->
                    <div class="max-h-[350px] custom-scroll pr-2">
                        <div id="payroll-container" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            <!-- Sera rempli par fetchPayrollData() -->
                            <div class="col-span-full text-center py-4 text-slate-400 italic text-xs">Recherche des bulletins...</div>
                        </div>
                    </div>
                </div>



            </div>
        </div>
    </section>




                    <!-- VUE 6: AIDE & INFOS -->
    <section id="view-help" class="view-section">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-2xl font-extrabold text-slate-800 mb-8">Centre d'Information</h2>

            <!-- ZONE 1 : FLASH INFO / ANNONCE G√âN√âRALE -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-3xl p-8 text-white shadow-xl mb-10 relative overflow-hidden">
                <div class="relative z-10">
                    <div class="flex items-center gap-3 mb-4">
                        <span class="bg-white/20 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border border-white/30">Note de service</span>
                        <span class="text-xs font-medium opacity-80"><i class="fa-regular fa-clock mr-1"></i> Mis √† jour le 18/01/2026</span>
                    </div>
                    <h3 class="text-2xl font-bold mb-2">Bienvenue sur le nouveau portail SIRH !</h3>
                    <p class="text-blue-100 text-sm leading-relaxed max-w-2xl">
                        Cette application est d√©sormais votre outil unique pour la gestion de vos pr√©sences et de vos cong√©s.
                        Pensez √† bien <strong>activer la g√©olocalisation</strong> sur votre t√©l√©phone pour valider vos pointages.
                        Pour toute question technique, r√©f√©rez-vous aux guides ci-dessous.
                    </p>
                </div>
                <!-- D√©co fond -->
                <i class="fa-solid fa-bullhorn absolute -right-6 -bottom-6 text-9xl opacity-10 rotate-[-20deg]"></i>
            </div>

            <!-- ZONE 2 : GUIDES D'UTILISATION (FAQ) -->
            <h3 class="font-black text-slate-700 uppercase text-sm tracking-widest mb-6">Guides Rapides</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
                
                <!-- Carte 1 : Pointage -->
                <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm hover:shadow-md transition-all">
                    <div class="w-12 h-12 bg-emerald-50 text-emerald-600 rounded-2xl flex items-center justify-center text-xl mb-4">
                        <i class="fa-solid fa-fingerprint"></i>
                    </div>
                    <h4 class="font-bold text-slate-800 mb-2">Comment pointer ?</h4>
                    <p class="text-sm text-slate-500 leading-relaxed mb-4">
                        Le pointage est obligatoire √† l'arriv√©e et au d√©part.
                        <br>1. Allez sur "Mon Profil".
                        <br>2. Cliquez sur le gros bouton <strong>ENTR√âE</strong>.
                        <br>3. Autorisez la localisation si demand√©.
                        <br><em>Note : Le bouton devient ROUGE quand vous √™tes en poste.</em>
                    </p>
                </div>

                <!-- Carte 2 : Cong√©s -->
                <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm hover:shadow-md transition-all">
                    <div class="w-12 h-12 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center text-xl mb-4">
                        <i class="fa-solid fa-plane-departure"></i>
                    </div>
                    <h4 class="font-bold text-slate-800 mb-2">Demander un cong√©</h4>
                    <p class="text-sm text-slate-500 leading-relaxed mb-4">
                        Les demandes doivent √™tre faites 48h √† l'avance.
                        <br>1. Sur "Mon Profil", cliquez sur "Demander Cong√©".
                        <br>2. Remplissez les dates et le motif.
                        <br>3. <strong>Joignez un justificatif</strong> (PDF ou Photo) si c'est une maladie.
                        <br>Vous recevrez la r√©ponse de votre manager ici m√™me.
                    </p>
                </div>

                <!-- Carte 3 : Documents -->
                <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm hover:shadow-md transition-all">
                    <div class="w-12 h-12 bg-orange-50 text-orange-600 rounded-2xl flex items-center justify-center text-xl mb-4">
                        <i class="fa-solid fa-folder-open"></i>
                    </div>
                    <h4 class="font-bold text-slate-800 mb-2">Mes Documents</h4>
                    <p class="text-sm text-slate-500 leading-relaxed mb-4">
                        Votre contrat sign√© et vos pi√®ces d'identit√© sont stock√©s dans la section "Mes Documents".
                        Vous pouvez cliquer sur l'ic√¥ne <i class="fa-solid fa-file-arrow-up text-xs"></i> pour mettre √† jour une pi√®ce p√©rim√©e (ex: nouveau passeport).
                    </p>
                </div>

                <!-- Carte 4 : Support -->
                <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800 shadow-sm text-white">
                    <div class="w-12 h-12 bg-white/10 rounded-2xl flex items-center justify-center text-xl mb-4">
                        <i class="fa-solid fa-headset"></i>
                    </div>
                    <h4 class="font-bold text-white mb-2">Besoin d'aide ?</h4>
                    <p class="text-sm text-slate-400 leading-relaxed mb-4">
                        Si vous rencontrez un bug ou si vous avez perdu vos acc√®s, contactez le service IT ou RH.
                    </p>
                    <div class="bg-white/10 p-3 rounded-xl flex items-center gap-3">
                        <i class="fa-solid fa-envelope text-blue-400"></i>
                        <span class="font-mono text-xs">support-sirh@entreprise.com</span>
                    </div>
                </div>

            </div>
        </div>
    </section>






<section id="view-settings" class="view-section">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
        <div>
            <h2 class="text-2xl font-black text-slate-800">Configuration des Bureaux</h2>
            <p class="text-sm text-slate-500 font-bold uppercase tracking-widest">Gestion des zones de pointage autoris√©es</p>
        </div>
        
        <div class="flex flex-wrap gap-2 w-full md:w-auto">
            <!-- Bouton Import CSV -->
            <button onclick="triggerZonesCSVImport()" class="flex-1 md:flex-none justify-center bg-emerald-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg active:scale-95 transition-all flex items-center gap-2">
                <i class="fa-solid fa-file-import"></i> Importer Si√®ges
            </button>
            
            <button onclick="openAddZoneModal()" class="flex-1 md:flex-none justify-center bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg active:scale-95 transition-all">
                <i class="fa-solid fa-location-dot mr-2"></i> Ajouter manuellement
            </button>

            <!-- Input invisible pour le fichier CSV -->
            <input type="file" id="csv-zones-input" class="hidden" accept=".csv" onchange="handleZonesCSVFile(event)">
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="zones-container">
        <!-- Rempli par JS -->
    </div>
</section>


        <!-- AJOUTER CETTE SECTION DANS ton index.html (entre deux sections existantes) -->
<section id="view-contract-templates" class="view-section">
    <div class="flex justify-between items-center mb-8">
        <div>
            <h2 class="text-2xl font-black text-slate-800 tracking-tight">Mod√®les de Contrats</h2>
            <p class="text-sm text-slate-500 font-bold uppercase tracking-widest">Gestion des formats juridiques par r√¥le</p>
        </div>
        <button data-perm="can_manage_config" onclick="openAddTemplateModal()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg active:scale-95 transition-all flex items-center gap-2">
            <i class="fa-solid fa-upload"></i> Uploader un Mod√®le
        </button>
    </div>

    <div class="bg-white rounded-[2rem] shadow-xl border border-slate-200 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-left whitespace-nowrap">
                <thead class="bg-slate-900 text-white text-[10px] uppercase font-bold">
                    <tr>
                        <th class="px-6 py-5">R√¥le Cible</th>
                        <th class="px-6 py-5">Libell√© du Mod√®le</th>
                        <th class="px-6 py-5">Fichier Stock√©</th>
                        <th class="px-6 py-5 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody id="templates-body" class="divide-y divide-slate-100">
                    <!-- Rempli par JS -->
                </tbody>
            </table>
        </div>
    </div>
</section>

        <section id="view-mobile-locations" class="view-section">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
        <div>
            <h2 class="text-2xl font-black text-slate-800">Lieux & Sites</h2>
            <p class="text-sm text-slate-500 font-bold uppercase tracking-widest">Base de donn√©es des points de passage</p>
        </div>
        
        <div class="flex flex-wrap gap-2 w-full md:w-auto">
            <!-- Bouton Import CSV -->
            <button data-perm="can_manage_config" onclick="triggerCSVImport()" class="flex-1 md:flex-none justify-center bg-emerald-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg active:scale-95 transition-all flex items-center gap-2">
                <i class="fa-solid fa-file-import"></i> Importer CSV
            </button>
            
            <!-- Bouton Ajout Manuel -->
            <button data-perm="can_manage_config" onclick="openAddLocationModal()" class="flex-1 md:flex-none justify-center bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg active:scale-95 transition-all flex items-center gap-2">
                <i class="fa-solid fa-map-pin"></i> Ajouter un Lieu
            </button>

            <!-- Input invisible pour le fichier CSV -->
            <input type="file" id="csv-file-input" class="hidden" accept=".csv" onchange="handleCSVFile(event)">
        </div>
    </div>

    <!-- Grille des lieux -->
    <div id="locations-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Rempli par JS -->
        <div class="col-span-full text-center py-10 text-slate-400 italic">Chargement des lieux...</div>
    </div>
</section>


        <section id="view-mobile-planning" class="view-section">
    <div class="flex justify-between items-center mb-8">
        <div>
            <h2 class="text-2xl font-black text-slate-800">Plannings & Missions</h2>
            <p class="text-sm text-slate-500 font-bold uppercase tracking-widest">Affectation des agents sur le terrain</p>
        </div>
        <button data-perm="can_manage_schedules" onclick="openAddScheduleModal()" class="bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg active:scale-95 transition-all flex items-center gap-2">
            <i class="fa-solid fa-calendar-plus"></i> Cr√©er une Mission
        </button>
    </div>

    <!-- Tableau des missions -->
    <div class="bg-white rounded-[2rem] shadow-xl border border-slate-200 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-left whitespace-nowrap">
                <thead class="bg-slate-50 text-[10px] uppercase font-black text-slate-400">
                    <tr>
                        <th class="px-6 py-4">Date / Heure</th>
                        <th class="px-6 py-4">Agent</th>
                        <th class="px-6 py-4">Lieu de Mission</th>
                        <th class="px-6 py-4 text-center">Statut</th>
                        <th class="px-6 py-4 text-right">Actions</th>
                    </tr>
                </thead>
                <tbody id="planning-body" class="divide-y divide-slate-100">
                    <!-- Rempli par JS -->
                </tbody>
            </table>
        </div>
    </div>
</section>







        
        
        <section id="view-mobile-reports" class="view-section">
            <!-- 1. BARRE DE FILTRES PRO -->
            <div class="bg-white p-6 rounded-[2rem] shadow-sm border mb-6 flex flex-wrap gap-4 items-end">
                <div class="flex-1 min-w-[200px]">
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2">Rechercher un d√©l√©gu√©</label>
                    <input type="text" id="filter-report-name" 
                           onkeyup="handleReportSearch()" 
                           placeholder="Rechercher un d√©l√©gu√©..." 
                           class="w-full p-3 bg-slate-50 border-none rounded-2xl text-sm focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="w-48">
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2">P√©riode d'affichage</label>
                    <select id="filter-report-date" onchange="fetchMobileReports()" class="w-full p-3 bg-slate-50 border-none rounded-2xl text-sm font-bold">
                        <option value="today">Aujourd'hui</option>
                        <option value="month" selected>Mois en cours</option>
                    </select>
                </div>
                <!-- Bouton de raccourci vers la synth√®se -->
                <button data-perm="can_view_reports" onclick="changeReportTab('audit')" class="bg-blue-600 text-white px-6 py-3 rounded-2xl font-black text-xs shadow-lg hover:scale-105 transition-all">
                    <i class="fa-solid fa-magnifying-glass-chart mr-2"></i> VOIR L'AUDIT
                </button>
            </div>
        
            <!-- 2. ZONE DE STATISTIQUES (3 CARTES PREMIUM INT√âGR√âES) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <!-- Carte 1 : Visites -->
                <div class="bg-slate-900 p-6 rounded-[2rem] text-white shadow-xl relative overflow-hidden">
                    <div class="relative z-10">
                        <p id="stat-report-label" class="text-[10px] font-black uppercase opacity-60 tracking-widest">Visites Identifi√©es</p>
                        <h3 id="stat-visites-total" class="text-4xl font-black mt-1">0</h3>
                    </div>
                    <i class="fa-solid fa-location-dot absolute -right-4 -bottom-4 text-6xl opacity-10"></i>
                </div>
                
                <!-- Carte 2 : Produits (NOUVEAU) -->
                <div class="bg-blue-600 p-6 rounded-[2rem] text-white shadow-xl relative overflow-hidden">
                    <div class="relative z-10">
                        <p class="text-[10px] font-black uppercase opacity-80 tracking-widest">Produits Pr√©sent√©s</p>
                        <h3 id="stat-produits-total" class="text-4xl font-black mt-1">0</h3>
                    </div>
                    <i class="fa-solid fa-pills absolute -right-4 -bottom-4 text-6xl opacity-20"></i>
                </div>
        
                <!-- Carte 3 : Agents (NOUVEAU) -->
                <div class="bg-emerald-500 p-6 rounded-[2rem] text-white shadow-xl relative overflow-hidden">
                    <div class="relative z-10">
                        <p class="text-[10px] font-black uppercase opacity-80 tracking-widest">Agents sur le terrain</p>
                        <h3 id="stat-agents-actifs" class="text-4xl font-black mt-1">0</h3>
                    </div>
                    <i class="fa-solid fa-users absolute -right-4 -bottom-4 text-6xl opacity-20"></i>
                </div>
            </div>
        
            <!-- 3. NAVIGATION PAR ONGLETS (VISITES / BILANS / SYNTH√àSE) -->
            <div class="flex flex-wrap gap-6 mb-6 border-b border-slate-200">
                <button onclick="changeReportTab('visits')" id="tab-visits" class="report-tab-btn pb-4 text-sm font-bold text-blue-600 border-b-2 border-blue-600 transition-all">
                    Visites de Sites (Cachets)
                </button>
                <button onclick="changeReportTab('daily')" id="tab-daily" class="report-tab-btn pb-4 text-sm font-bold text-slate-400 border-b-2 border-transparent transition-all">
                    Bilans Journaliers (Cahiers)
                </button>
                <button onclick="changeReportTab('audit')" id="tab-audit" class="report-tab-btn pb-4 text-sm font-bold text-slate-400 border-b-2 border-transparent transition-all">
                    üìä Synth√®se d'Audit
                </button>
            </div>
        
            <!-- 4. S√âLECTEUR DE VUE (LISTE VS GALERIE) -->
            <div id="view-switcher-area" class="flex justify-end gap-2 mb-4">
                <button onclick="setReportView('list')" id="btn-view-list" class="p-2 bg-blue-100 text-blue-600 rounded-lg shadow-sm border border-blue-200 transition-all">
                    <i class="fa-solid fa-list"></i>
                </button>
                <button onclick="setReportView('grid')" id="btn-view-grid" class="p-2 bg-slate-100 text-slate-400 rounded-lg shadow-sm border border-slate-200 transition-all">
                    <i class="fa-solid fa-grip"></i>
                </button>
            </div>
        
            <!-- 5. CONTENEUR UNIQUE POUR L'INJECTION DES DONN√âES -->
            <div id="reports-list-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Ce conteneur sera rempli dynamiquement par fetchMobileReports() ou fetchGlobalAudit() -->
            </div>
        </section>
        

        
                </div>
            </main>
        </div>

        <!-- MODAL DOSSIER COMPLET (VERSION PREMIUM UX) -->
<div id="folder-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md hidden flex items-center justify-center z-[200] p-4 transition-all duration-300">
    
    <!-- Conteneur principal avec arrondi XL (40px) -->
    <div class="bg-white w-full max-w-5xl rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col md:flex-row h-[90vh] md:h-auto max-h-[95vh] border border-white/20 animate-fadeIn">
        
        <!-- COLONNE GAUCHE : IDENTIT√â (Design Immersif) -->
        <div class="md:w-1/3 bg-slate-900 p-8 text-white flex flex-col items-center text-center shrink-0">
            <!-- Photo avec bordure et ombre port√©e -->
            <div class="w-32 h-32 rounded-[2.5rem] bg-slate-800 mb-6 overflow-hidden border-2 border-slate-700 shadow-2xl">
                <img id="folder-photo" class="w-full h-full object-cover">
            </div>
            
            <h3 id="folder-name" class="text-2xl font-black mb-1 uppercase tracking-tight leading-tight">...</h3>
            <p id="folder-id" class="text-blue-500 font-mono text-[10px] mb-8 uppercase tracking-widest bg-blue-500/10 px-3 py-1 rounded-full">...</p>
            
            <!-- Blocs d'informations stylis√©s -->
            <div class="w-full space-y-3 text-left">
                <div class="bg-white/5 p-4 rounded-2xl border border-white/10">
                    <p class="text-[9px] text-slate-500 font-black uppercase tracking-tighter mb-1">Poste Actuel</p>
                    <p id="folder-poste" class="text-sm font-bold text-slate-200">...</p>
                    <p id="folder-dept" class="text-[11px] text-blue-400 font-medium">...</p>
                </div>
                
                <div class="bg-blue-600/10 p-4 rounded-2xl border border-blue-500/20">
                    <p class="text-[9px] text-blue-300 font-black uppercase tracking-tighter mb-1">Validit√© Contrat</p>
                    <p class="text-xs font-bold text-white"><span id="folder-start">--</span> ‚ûî <span id="folder-end">--</span></p>
                </div>
            </div>
            
            <!-- Bouton de fermeture int√©gr√© -->
            <button onclick="closeFolderModal()" class="mt-8 w-full py-4 rounded-2xl bg-white/10 hover:bg-red-500/20 hover:text-red-400 transition-all font-black text-[10px] uppercase tracking-widest active:scale-95">
                FERMER LE DOSSIER
            </button>
        </div>

        <!-- COLONNE DROITE : ARCHIVES & CONTACTS (A√©r√© & Lisible) -->
        <div class="flex-1 p-8 md:p-12 md:overflow-y-auto bg-slate-50 custom-scroll min-h-[400px]">
            
            <!-- Titre Section 1 -->
            <div class="flex items-center gap-4 mb-8">
                <div class="h-[1px] flex-1 bg-slate-200"></div>
                <h4 class="text-slate-400 font-black text-[10px] uppercase tracking-[0.2em]">Archives Num√©riques</h4>
                <div class="h-[1px] flex-1 bg-slate-200"></div>
            </div>
            
            <!-- Grille des documents (G√©r√©e par ton JS) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-12" id="folder-docs-grid"></div>
            
            <!-- Titre Section 2 -->
            <div class="flex items-center gap-4 mb-6">
                <div class="h-[1px] flex-1 bg-slate-200"></div>
                <h4 class="text-slate-400 font-black text-[10px] uppercase tracking-[0.2em]">Contacts & Coordonn√©es</h4>
                <div class="h-[1px] flex-1 bg-slate-200"></div>
            </div>
            
            <!-- Cartes de coordonn√©es -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-5 rounded-2xl border border-slate-200/60 shadow-sm transition-all hover:shadow-md">
                    <p class="text-[9px] text-slate-400 font-black uppercase mb-1">Email Personnel</p>
                    <p id="folder-email" class="font-bold text-slate-800 text-sm italic truncate">...</p>
                </div>
                
                <div class="bg-white p-5 rounded-2xl border border-slate-200/60 shadow-sm transition-all hover:shadow-md">
                    <p class="text-[9px] text-slate-400 font-black uppercase mb-1">T√©l√©phone Direct</p>
                    <p id="folder-phone" class="font-bold text-slate-800 text-sm">...</p>
                </div>
                
                <div class="bg-white p-5 rounded-2xl border border-slate-200/60 shadow-sm transition-all hover:shadow-md md:col-span-2">
                    <p class="text-[9px] text-slate-400 font-black uppercase mb-1">Adresse de R√©sidence</p>
                    <p id="folder-address" class="font-bold text-slate-800 text-sm">...</p>
                </div>
            </div>
        </div>
        
    </div>
</div>



        <!-- MODAL ADMINISTRATION (VERSION PREMIUM UX) -->
    <div id="edit-modal" class="fixed inset-0 bg-slate-900/60 hidden flex items-center justify-center z-[200] p-4 backdrop-blur-md transition-all duration-300">
        
        <!-- Boite principale avec arrondi XL et ombre profonde -->
        <div class="bg-white w-full max-w-lg rounded-[2.5rem] p-10 shadow-2xl overflow-y-auto max-h-[90vh] border border-white/20 animate-fadeIn">
            
            <!-- En-t√™te de la modale -->
            <div class="flex justify-between items-center mb-10">
                <div>
                    <h3 class="font-black text-2xl uppercase text-slate-800 tracking-tighter">Administration</h3>
                    <p class="text-[10px] font-black text-blue-600 uppercase tracking-[0.2em]">Mise √† jour du collaborateur</p>
                </div>
                <button onclick="closeEditModal()" class="w-12 h-12 flex items-center justify-center rounded-2xl bg-slate-100 text-slate-400 hover:bg-red-50 hover:text-red-500 transition-all active:scale-90">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>
            </div>
            
            <input type="hidden" id="edit-id-hidden">
            
            <form onsubmit="submitUpdate(event)" class="space-y-8">
                
                <!-- 1. BLOC : STATUT & ACC√àS -->
                <div class="space-y-4">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Statut & Habilitations</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-slate-50 p-1.5 rounded-2xl border border-slate-100">
                            <label class="block text-[9px] font-black text-slate-400 uppercase mb-1 ml-2">√âtat Civil</label>
                            <select id="edit-statut" class="w-full p-3 bg-transparent font-bold text-slate-700 outline-none cursor-pointer">
                                <option value="Actif">üü¢ Actif</option>
                                <option value="Cong√©">üü° En Cong√©</option>
                                <option value="Sortie">üî¥ Sortie D√©finitive</option>
                            </select>
                        </div>
                        <div class="bg-blue-50/50 p-1.5 rounded-2xl border border-blue-100">
                            <label class="block text-[9px] font-black text-blue-400 uppercase mb-1 ml-2">R√¥le Syst√®me</label>
                            <select id="edit-role" class="w-full p-3 bg-transparent font-black text-blue-700 outline-none cursor-pointer">
                                <!-- Rempli par JS -->
                            </select>
                        </div>
                    </div>

                    <div class="bg-indigo-50/50 p-1.5 rounded-2xl border border-indigo-100">
                        <label class="block text-[9px] font-black text-indigo-400 uppercase mb-1 ml-2">Type d'Activit√© (R√®gle GPS)</label>
                        <select id="edit-type" class="w-full p-3 bg-transparent font-black text-indigo-700 outline-none cursor-pointer">
                            <option value="OFFICE">üè¢ Bureau (Fixe)</option>
                            <option value="FIXED">üè† Agent Site (Fixe)</option>
                            <option value="MOBILE">üöó D√©l√©gu√© (Nomade)</option>
                        </select>
                    </div>

                    <div class="bg-slate-50 p-1.5 rounded-2xl border border-slate-100">
                        <label class="block text-[9px] font-black text-slate-400 uppercase mb-1 ml-2">D√©partement / Service</label>
                        <select id="edit-dept" class="w-full p-3 bg-transparent font-bold text-slate-700 outline-none cursor-pointer">
                            <!-- Rempli par JS -->
                        </select>
                    </div>
                </div>

                <!-- 2. BLOC : GESTION CONTRAT (Design Orange soft) -->
                <div class="p-6 bg-orange-50/50 rounded-[2rem] border border-orange-100 space-y-4">
                    <p class="text-[10px] font-black text-orange-600 uppercase tracking-widest flex items-center gap-2">
                        <i class="fa-solid fa-file-contract"></i> Cycle de vie du Contrat
                    </p>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[9px] font-black text-slate-400 uppercase mb-2 ml-1">Dur√©e / Type</label>
                            <select id="edit-type-contrat" class="w-full p-3 bg-white border border-orange-100 rounded-xl text-xs font-bold text-slate-700 shadow-sm outline-none focus:ring-2 focus:ring-orange-200">
                                <option value="365">CDI (1 an)</option>
                                <option value="180">CDD (6 mois)</option>
                                <option value="90">Essai (3 mois)</option>
                                <option value="30">Stage</option>
                                <option value="0">Freelance / Prestation</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[9px] font-black text-slate-400 uppercase mb-2 ml-1">Date d'effet</label>
                            <input type="date" id="edit-start-date" class="w-full p-3 bg-white border border-orange-100 rounded-xl text-xs font-bold text-slate-700 shadow-sm outline-none">
                        </div>
                    </div>
                    <div class="mt-3 flex items-start gap-3 bg-white/60 p-3 rounded-xl border border-orange-100">
                        <input type="checkbox" id="edit-init-check" class="mt-1 w-5 h-5 text-orange-600 rounded-lg border-orange-200 focus:ring-orange-500 cursor-pointer">
                        <label for="edit-init-check" class="text-[10px] text-orange-800 leading-tight font-medium">
                            <b>Forcer l'initialisation :</b> R√©initialise le contrat √† la date choisie (Embauche ou Renouvellement).
                        </label>
                    </div>
                </div>

                <!-- 3. BLOC : HI√âRARCHIE (Design Indigo soft) -->
                <div class="p-6 bg-indigo-50/50 rounded-[2rem] border border-indigo-100 space-y-4">
                    <p class="text-[10px] font-black text-indigo-600 uppercase tracking-widest flex items-center gap-2">
                        <i class="fa-solid fa-sitemap"></i> Management & Hi√©rarchie
                    </p>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-[9px] font-black text-slate-400 uppercase mb-2 ml-1">Responsable Direct (N+1)</label>
                            <select id="edit-manager" class="w-full p-3 bg-white border border-indigo-100 rounded-xl text-xs font-bold text-slate-700 shadow-sm outline-none">
                                <option value="">-- Aucun / Autonome --</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[9px] font-black text-slate-400 uppercase mb-2 ml-1">P√©rim√®tre G√©r√© (Scope)</label>
                            <input type="text" id="edit-scope" class="w-full p-3 bg-white border border-indigo-100 rounded-xl text-xs font-bold text-slate-700 shadow-sm outline-none" placeholder="Ex: IT, Finance, Cotonou...">
                        </div>
                    </div>
                </div>

                <!-- Bouton d'action massif -->
                <button type="submit" class="w-full bg-slate-900 text-white py-5 rounded-[1.5rem] font-black text-xs uppercase tracking-[0.2em] shadow-xl hover:bg-blue-600 hover:shadow-blue-500/20 transition-all active:scale-95">
                    Enregistrer les modifications
                </button>
            </form>
        </div>
    </div>

         <!-- MODAL SIGNATURE NUM√âRIQUE (VERSION PREMIUM UX) -->
<div id="contract-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md hidden flex items-center justify-center z-[200] p-4 transition-all duration-300">
    
    <!-- Boite principale avec arrondi XL et alignement centr√© pour la confiance -->
    <div class="bg-white w-full max-w-lg rounded-[2.5rem] p-10 shadow-2xl animate-fadeIn border border-white/20 text-center">
        
        <!-- Ic√¥ne de r√©assurance -->
        <div class="w-16 h-16 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center text-2xl mx-auto mb-6 shadow-sm">
            <i class="fa-solid fa-file-signature"></i>
        </div>
        
        <h3 class="font-black text-2xl uppercase text-slate-800 tracking-tighter mb-2">Signature Num√©rique</h3>
        <p class="text-slate-400 text-xs font-medium mb-8 leading-relaxed px-4">Utilisez votre doigt ou votre souris pour signer. Cette action vaut acceptation du contrat.</p>
        
        <input type="hidden" id="contract-id-hidden">
        
        <!-- Cadre de signature stylis√© -->
        <div class="bg-slate-50 p-2 rounded-[2rem] border-2 border-dashed border-slate-200 mb-8 relative overflow-hidden">
            <canvas id="signature-pad" class="w-full h-48 bg-white rounded-[1.5rem] border border-slate-100 cursor-crosshair shadow-inner"></canvas>
            
            <!-- Bouton effacer repositionn√© de fa√ßon discr√®te -->
            <button type="button" onclick="clearSignature()" class="absolute bottom-4 right-4 bg-slate-100/80 backdrop-blur text-slate-400 px-3 py-1 rounded-lg text-[9px] font-black uppercase hover:bg-red-50 hover:text-red-500 transition-all active:scale-90">
                <i class="fa-solid fa-eraser mr-1"></i> Effacer
            </button>
            
            <div class="absolute bottom-4 left-6 pointer-events-none">
                <p class="text-[8px] font-black text-slate-300 uppercase tracking-widest">Zone de validation</p>
            </div>
        </div>

        <!-- Actions -->
        <div class="flex gap-3">
            <button onclick="closeContractModal()" class="flex-1 py-4 rounded-2xl text-slate-400 font-bold text-[10px] uppercase tracking-widest hover:bg-slate-50 transition-all active:scale-95">
                Annuler
            </button>
            <button onclick="submitSignedContract()" class="flex-[2] bg-slate-900 text-white py-4 rounded-2xl font-black text-[10px] uppercase tracking-[0.15em] shadow-xl hover:bg-blue-600 transition-all active:scale-95">
                Valider & Signer
            </button>
        </div>
        
        <p class="mt-6 text-[8px] text-slate-300 font-medium uppercase tracking-widest">Protocole de signature √©lectronique s√©curis√©</p>
    </div>
</div>



      <!-- MODAL DEMANDE CONG√â (VERSION PREMIUM UX) -->
<div id="leave-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md hidden flex items-center justify-center z-[200] p-4 transition-all duration-300">
    
    <!-- Boite principale avec arrondi XL -->
    <div class="bg-white w-full max-w-lg rounded-[2.5rem] p-10 shadow-2xl animate-fadeIn border border-white/20">
        
        <!-- En-t√™te -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h3 class="font-black text-2xl uppercase text-slate-800 tracking-tighter">Absences</h3>
                <p class="text-[10px] font-black text-blue-600 uppercase tracking-[0.2em]">Nouvelle demande de cong√©</p>
            </div>
            <button onclick="document.getElementById('leave-modal').classList.add('hidden')" class="w-10 h-10 flex items-center justify-center rounded-2xl bg-slate-100 text-slate-400 hover:text-red-500 transition-all active:scale-90">
                <i class="fa-solid fa-xmark text-lg"></i>
            </button>
        </div>

        <form onsubmit="submitLeaveRequest(event)" class="space-y-6">
            
            <!-- 1. S√âLECTION DU TYPE (Design Chips) -->
            <div>
                <label class="block text-[10px] font-black text-slate-400 uppercase mb-3 ml-1">Nature de l'absence</label>
                <div class="grid grid-cols-3 gap-2">
                    <label class="cursor-pointer group">
                        <input type="radio" name="leave_type" value="Cong√© Pay√©" class="peer sr-only" checked>
                        <div class="p-3 border-2 border-slate-50 rounded-2xl text-center transition-all peer-checked:border-blue-600 peer-checked:bg-blue-50/50 shadow-sm">
                            <span class="block text-xl mb-1">üèñÔ∏è</span>
                            <span class="text-[9px] font-black uppercase text-slate-500 peer-checked:text-blue-700">Cong√©</span>
                        </div>
                    </label>
                    <label class="cursor-pointer group">
                        <input type="radio" name="leave_type" value="Maladie" class="peer sr-only">
                        <div class="p-3 border-2 border-slate-50 rounded-2xl text-center transition-all peer-checked:border-red-600 peer-checked:bg-red-50/50 shadow-sm">
                            <span class="block text-xl mb-1">üíä</span>
                            <span class="text-[9px] font-black uppercase text-slate-500 peer-checked:text-red-700">Maladie</span>
                        </div>
                    </label>
                    <label class="cursor-pointer group">
                        <input type="radio" name="leave_type" value="T√©l√©travail" class="peer sr-only">
                        <div class="p-3 border-2 border-slate-50 rounded-2xl text-center transition-all peer-checked:border-purple-600 peer-checked:bg-purple-50/50 shadow-sm">
                            <span class="block text-xl mb-1">üè†</span>
                            <span class="text-[9px] font-black uppercase text-slate-500 peer-checked:text-purple-700">Autres</span>
                        </div>
                    </label>
                </div>
            </div>

            <!-- 2. S√âLECTION DES DATES -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-slate-50 p-2 rounded-2xl border border-slate-100">
                    <label class="block text-[9px] font-black text-slate-400 uppercase mb-1 ml-2">Du (Matin)</label>
                    <input type="date" id="leave-start" class="w-full bg-transparent p-2 font-bold text-slate-700 outline-none text-sm" required>
                </div>
                <div class="bg-slate-50 p-2 rounded-2xl border border-slate-100">
                    <label class="block text-[9px] font-black text-slate-400 uppercase mb-1 ml-2">Au (Soir)</label>
                    <input type="date" id="leave-end" class="w-full bg-transparent p-2 font-bold text-slate-700 outline-none text-sm" required>
                </div>
            </div>

            <!-- 3. MOTIF -->
            <div>
                <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-1">Motif de la demande</label>
                <textarea id="leave-reason" rows="2" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none text-sm font-medium transition-all focus:bg-white focus:ring-2 focus:ring-blue-100" placeholder="Pr√©cisez la raison de votre absence..."></textarea>
            </div>

            <!-- 4. JUSTIFICATIF (Design Pro) -->
            <div class="p-5 bg-blue-50/50 rounded-3xl border border-blue-100">
                <label class="block text-[9px] font-black text-blue-400 uppercase mb-3 ml-1">Pi√®ce jointe / Justificatif</label>
                <div class="flex items-center gap-4">
                    <!-- Preview -->
                    <div id="leave-doc-preview" class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center border border-blue-100 text-blue-300 shadow-sm shrink-0">
                        <i class="fa-solid fa-camera text-lg"></i>
                    </div>
                    <!-- Actions -->
                    <div class="flex-1 grid grid-cols-2 gap-2">
                        <button type="button" onclick="openDocCamera('leave_justif')" class="bg-white text-slate-600 text-[10px] font-black py-2.5 rounded-xl border border-slate-200 uppercase tracking-tighter hover:bg-slate-100 transition-all">
                            Prendre Photo
                        </button>
                        <button type="button" onclick="document.getElementById('f-leave_justif').click()" class="bg-blue-600 text-white text-[10px] font-black py-2.5 rounded-xl uppercase tracking-tighter shadow-lg shadow-blue-500/20 active:scale-95 transition-all">
                            Uploader
                        </button>
                    </div>
                </div>
                <input type="file" id="f-leave_justif" class="hidden" onchange="previewDocFile(event, 'leave_justif')">
            </div>

            <!-- Bouton de validation -->
            <button type="submit" class="w-full bg-slate-900 text-white py-5 rounded-[1.5rem] font-black text-xs uppercase tracking-[0.2em] shadow-xl hover:bg-blue-600 transition-all active:scale-95">
                Soumettre la demande
            </button>
        </form>
    </div>
</div>

     <!-- MODAL ENVOI FLASH (VERSION PREMIUM UX) -->
    <div id="flash-modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md hidden flex items-center justify-center z-[200] p-4 transition-all duration-300">
        
        <!-- Boite principale avec arrondi XL -->
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-10 shadow-2xl animate-fadeIn border border-white/20">
            
            <!-- En-t√™te -->
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h3 class="font-black text-2xl uppercase text-slate-800 tracking-tighter">Annonce</h3>
                    <p class="text-[10px] font-black text-orange-500 uppercase tracking-[0.2em]">Diffusion imm√©diate</p>
                </div>
                <button onclick="document.getElementById('flash-modal').classList.add('hidden')" class="w-10 h-10 flex items-center justify-center rounded-2xl bg-slate-100 text-slate-400 hover:text-red-500 transition-all active:scale-90">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>
            </div>

            <form onsubmit="submitFlashMessage(event)" class="space-y-6">
                
                <!-- 1. PARAM√àTRES (S√©v√©rit√© & Temps) -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-slate-50 p-2 rounded-2xl border border-slate-100">
                        <label class="block text-[9px] font-black text-slate-400 uppercase mb-1 ml-2">S√©v√©rit√©</label>
                        <select id="flash-input-type" class="w-full bg-transparent p-1 font-bold text-xs text-slate-700 outline-none cursor-pointer">
                            <option value="Info">‚ÑπÔ∏è Information</option>
                            <option value="Urgent">üö® Urgence</option>
                            <option value="Maintenance">‚ö†Ô∏è Travaux</option>
                        </select>
                    </div>
                    <div class="bg-blue-50/50 p-2 rounded-2xl border border-blue-100">
                        <label class="block text-[9px] font-black text-blue-400 uppercase mb-1 ml-2">Visibilit√©</label>
                        <select id="flash-input-duration" class="w-full bg-transparent p-1 font-bold text-xs text-blue-700 outline-none cursor-pointer">
                            <option value="15">15 minutes</option>
                            <option value="30">30 minutes</option>
                            <option value="60" selected>1 heure</option>
                            <option value="120">2 heures</option>
                            <option value="240">4 heures</option>
                            <option value="720">12 heures</option>
                            <option value="1440">1 jour (24h)</option>
                            <option value="10080">1 semaine</option>
                        </select>
                    </div>
                </div>

                <!-- 2. MESSAGE -->
                <div>
                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-1">Contenu du message</label>
                    <textarea id="flash-input-msg" rows="4" class="w-full p-5 bg-slate-50 border border-slate-200 rounded-[1.5rem] outline-none font-medium text-sm leading-relaxed transition-all focus:bg-white focus:ring-2 focus:ring-orange-100" placeholder="√âcrivez votre annonce aux collaborateurs..." required></textarea>
                </div>

                <!-- Bouton Publier -->
                <button type="submit" class="w-full bg-slate-900 text-white py-5 rounded-[1.5rem] font-black text-xs uppercase tracking-[0.2em] shadow-xl hover:bg-orange-500 transition-all active:scale-95">
                    PUBLIER L'ANNONCE
                </button>
            </form>
        </div>
    </div>

    <script src="app.js"></script>


    </body>

    </html>




































